/** Initializations **/

// Debug
_ = function(a){ console.log(a) }

// Names of places, capitols, us capitols, countries, us states, in one string (0: category separator, 1: difficulty separator)
g = [[[["Cape canaveral",[44,92]],["Christ the redeemer",[72,186]],["The great chinese wall",[193,73]],["The great sphinx",[131,90]],["The eiffel tower",[109,57]],["Tower of pisa",[115,65]],["Mount everest",[174,92]],["Sagrada familia",[108,69]],["Big ben",[107,50]],["The statue of liberty",[50,74]],["Forbidden city",[194,73]],["The pyramids of giza",[131,90]],["The palace of versailles",[109,57]],["Acropolis",[125,76]],["Trevi fountain",[117,68]],["Kremlin",[133,45]],["Loch ness",[105,43]],["Atomium",[110,52]],["Lascaux caves",[108,62]],["Mont st. michel",[106,55]],["Piazza san marco",[116,62]],["The grand canyon",[22,79]],["Millau bridge",[109,63]],["Rock of gibraltar",[103,79]],["The empire state building",[52,69]],["Hollywood sign",[16,81]],["Times square",[51,71]],["Louvre museum",[109,57]],["White house",[49,75]],["Florence cathedral",[115,66]],["Las vegas",[19,79]],["Madrid palace",[104,71]],["Central park",[52,70]],["Sistine chapel",[116,67]],["Piazza del campo",[115,65]]],[["Machu picchu",[48,167]],["The burj al arab hotel",[149,99]],["St. peter's cathedral",[117,68]],["Kilimanjaro",[137,151]],["Capitol hill",[49,74]],["Luxor temple",[131,97]],["Golden gate bridge",[15,74]],["Burj khalifa",[150,99]],["Alcatraz",[15,76]],["Ephesus",[127,75]],["Manneken pis",[110,52]],["Mount eden crater",[239,212]],["North cape",[122,18]],["St. basil's cathedral",[133,45]],["Victoria falls",[127,177]],["The great buddha",[213,80]],["Lotus temple",[167,92]],["The colosseum",[117,68]],["Abu simbel",[131,103]],["Petronas twin towers",[188,139]],["Yellowstone",[26,67]],["Niagara falls",[49,66]],["The taj mahal",[167,92]],["Mount fuji",[212,79]],["Mecca",[138,103]],["Auschwitz",[121,52]],["Stonehenge",[106,51]],["Mount rushmore",[30,64]],["Pentagon",[48,75]],["Cape of good hope",[121,208]],["Opera house",[222,207]],["Parc guell",[108,69]],["Pompeii",[118,70]],["Dead sea",[134,87]]],[["Waterloo",[110,52]],["Easter island",[21,194]],["Everglades",[43,97]],["Cloud gate",[42,68]],["Rialto bridge",[116,62]],["Willis tower",[42,68]],["Little mermaid",[116,44]],["Tower bridge",[107,50]],["The blue mosque",[131,91]],["Nevado mismi",[49,172]],["Table mountain",[121,207]],["Minaret of jam",[156,82]],["Angkor wat",[190,120]],["Faisal mosque",[159,98]],["Neuschwanstein castle",[115,56]],["Golden temple of amritsar",[167,87]],["Al aqsa mosque",[134,85]],["Temple of besakih",[200,161]],["Chichen itza",[36,107]],["Bran castle",[125,62]],["Hagia sophia",[129,70]],["Uluru",[212,189]],["Brandenburg gate",[116,50]],["Blue domed church",[126,77]],["Taal lake",[204,118]],["Cheyenne mountain",[27,77]],["Kiyomizu-dera",[211,80]],["Petra",[134,88]],["Tombouctou",[104,114]],["Kultury i nauki palace",[122,50]]]],[[["Algiers",[109,78]],["Buenos aires",[62,208]],["Canberra",[221,208]],["Vienna",[118,57]],["Brussels",[110,52]],["Brasilia",[68,178]],["Sofia",[124,66]],["Ottawa",[51,61]],["Santiago",[52,204]],["Beijing",[194,73]],["Zagreb",[120,63]],["Havana",[42,102]],["Prague",[118,53]],["Copenhagen",[116,45]],["Quito",[43,145]],["Cairo",[130,90]],["Tallinn",[124,37]],["Helsinki",[125,35]],["Paris",[109,57]],["Berlin",[116,49]],["Athens",[124,75]],["Budapest",[121,58]],["Reykjavik",[95,29]],["New delhi",[165,90]],["Jakarta",[193,157]],["Tehran",[145,80]],["Baghdad",[141,84]],["Dublin",[103,48]],["Jerusalem",[134,88]],["Rome",[116,67]],["Kingston",[44,114]],["Tokyo",[212,80]],["Beirut",[134,83]],["Vilnius",[122,45]],["Luxembourg",[112,54]],["Skopje",[124,67]],["Antananarivo",[144,179]],["Mexico city",[27,108]],["Monaco",[112,65]],["Rabat",[101,83]],["Kathmandu",[174,94]],["Amsterdam",[111,49]],["Wellington",[238,217]],["Pyongyang",[201,72]],["Oslo",[115,35]],["Ramallah",[134,86]],["Asunción",[61,190]],["Lima",[45,168]],["Manila",[203,116]],["Warsaw",[122,50]],["Lisbon",[100,73]],["Bucharest",[126,62]],["Doha",[147,98]],["Moscow",[134,45]],["Riyadh",[143,102]],["Singapore",[190,141]],["Bratislava",[120,57]],["Ljubljana",[116,58]],["Pretoria",[129,192]],["Seoul",[203,77]],["Madrid",[104,71]],["Stockholm",[118,39]],["Bern",[113,59]],["Taipei",[202,99]],["Tunis",[114,77]],["Ankara",[134,72]],["Kyiv",[129,53]],["Montevideo",[64,208]],["Abu dhabi",[149,100]],["London",[107,51]],["Washington d.c.",[48,72]],["Caracas",[53,126]],["Vatican city",[116,66]],["Hanoi",[190,106]],["Georgetown",[59,133]],["Tripoli",[117,85]]],[["Kabul",[161,84]],["Andorra la vella",[108,67]],["Tirana",[122,68]],["Minsk",[126,47]],["Sarajevo",[123,66]],["Ouagadougou",[105,121]],["Yaoundé",[116,138]],["Bangui",[121,137]],["Brazzaville",[119,152]],["Kinshasa",[119,153]],["Yamoussoukro",[102,132]],["San jose",[39,126]],["Bogotá",[47,136]],["La paz",[52,176]],["Praia",[88,117]],["Nicosia",[132,81]],["Porto-novo",[109,133]],["Phnom penh",[191,122]],["Roseau",[57,117]],["Santo domingo",[50,111]],["Malabo",[113,138]],["Guatemala city",[33,117]],["Port-au-prince",[49,110]],["Tegucigalpa",[37,118]],["Amman",[135,85]],["Astana",[159,52]],["Pristina",[123,68]],["Kuwait city",[144,91]],["Vientiane",[188,111]],["Nairobi",[136,147]],["Kuala lumpur",[189,139]],["Bamako",[100,121]],["Valletta",[118,79]],["Chisinau",[128,59]],["Islamabad",[158,94]],["Panama city",[42,128]],["San marino",[116,64]],["Dakar",[93,118]],["Belgrade",[122,65]],["Victoria",[151,153]],["Mogadishu",[143,141]],["Sri jayawardenepura kotte",[171,132]],["Khartoum",[130,116]],["Dodoma",[135,156]],["Bangkok",[187,119]],["Sana'a",[142,117]],["Harare",[131,177]]],[["Saint john's",[56,113]],["Yerevan",[140,70]],["Baku",[143,71]],["Luanda",[117,161]],["Nassau",[46,99]],["Manama",[146,96]],["Dhaka",[177,101]],["Bridgetown",[58,121]],["Belmopan",[36,113]],["Thimphu",[177,93]],["Gaborone",[127,190]],["Bandar seri begawan",[199,136]],["Bujumbura",[130,151]],["N'djamena",[118,123]],["Moroni",[141,166]],["Djibouti",[141,123]],["San salvador",[35,120]],["Asmara",[138,117]],["Addis ababa",[138,129]],["Suva",[249,178]],["Libreville",[114,145]],["Banjul",[93,120]],["Tbilisi",[140,68]],["Accra",[106,134]],["St. george's",[57,122]],["Conakry",[95,126]],["Bissau",[94,123]],["South tarawa",[251,161]],["Bishkek",[162,67]],["Riga",[124,41]],["Maseru",[128,198]],["Monrovia",[98,133]],["Vaduz",[114,58]],["Lilongwe",[134,170]],["Male",[165,138]],["Majuro",[244,131]],["Nouakchott",[94,111]],["Port louis",[152,182]],["Palikir",[223,120]],["Ulaanbaatar",[188,61]],["Podgorica",[122,68]],["Maputo",[133,191]],["Naypyidaw",[183,107]],["Windhoek",[120,186]],["Yaren district",[239,148]],["Managua",[37,122]],["Niamey",[109,119]],["Abuja",[112,128]],["Muscat",[153,103]],["Ngerulmud",[215,131]],["Port moresby",[224,32]],["Kigali",[131,148]],["Basseterre",[56,112]],["Castries",[57,119]],["Kingstown",[57,121]],["Apia",[253,172]],["São tomé",[112,145]],["Freetown",[96,129]],["Honiara",[235,162]],["Juba",[132,133]],["Paramaribo",[60,135]],["Mbabane",[131,193]],["Damascus",[136,81]],["Dushanbe",[158,74]],["Dili",[208,162]],["Lomé",[107,133]],["Nuku'alofa",[253,184]],["Port of spain",[57,122]],["Ashgabat",[150,74]],["Funafuti",[252,32]],["Kampala",[133,144]],["Tashkent",[159,69]],["Port vila",[241,176]],["Lusaka",[128,172]]]],[[["Honolulu",[4,238]],["Juneau",[64,17]],["Olympia",[98,95]],["Carson city",[109,159]],["Santa fe",[146,181]],["Albany",[234,132]],["Tallahassee",[207,218]],["Springfield",[193,153]],["Columbus",[211,153]],["Providence",[243,139]],["Columbia",[215,197]],["Austin",[168,221]],["Salt lake city",[129,146]],["Richmond",[226,171]],["Charleston",[215,165]],["Harrisburg",[226,150]],["Boston",[244,135]],["Raleigh",[187,222]],["Montgomery",[200,207]],["Sacramento",[102,156]],["Denver",[149,155]],["Atlanta",[207,196]],["Lansing",[206,130]]],[["Bismarck",[161,100]],["Helena",[129,103]],["Lincoln",[173,148]],["Phoenix",[129,195]],["Little rock",[184,190]],["Concord",[242,128]],["Trenton",[234,149]],["Hartford",[239,140]],["Dover",[232,159]],["Oklahoma city",[170,186]],["Boise",[117,126]],["Salem",[99,116]],["Indianapolis",[201,153]],["Des moines",[182,142]],["Topeka",[174,159]],["Pierre",[162,120]],["Frankfort",[205,166]],["Nashville",[199,181]],["Baton rouge",[187,219]],["Augusta",[248,118]],["Annapolis",[228,32]],["Montpelier",[239,121]],["St. paul",[182,118]],["Jackson",[190,207]],["Madison",[193,127]],["Jefferson city",[185,163]],["Cheyenne",[150,143]]]],[[["Algeria",[105,81,107,78,113,76,112,82,114,88,114,97,116,102,111,109,109,110,100,95,99,93,106,85,255,109,78]],["Argentina",[54,185,57,185,58,189,61,191,61,195,63,195,64,191,64,195,62,200,62,208,64,212,63,215,60,216,60,220,59,220,60,223,58,229,60,232,59,237,60,240,57,239,55,235,56,233,53,216,53,206,52,199,255,60,241,61,245,64,245]],["Australia",[197,186,203,180,208,170,210,172,212,166,216,167,215,172,218,177,221,164,222,170,223,180,225,183,227,193,225,203,220,213,216,216,213,215,212,209,210,208,209,204,207,203,200,207,198,207,196,210,195,207,196,203,196,192,255,214,219,217,219,215,224,214,224]],["Austria",[115,58,119,60,119,55]],["Belgium",[109,51,112,51,111,54]],["Brazil",[64,191,64,195,62,200,66,205,69,196,68,192,71,187,74,186,75,174,75,168,78,162,78,155,74,149,70,149,66,144,64,137,63,141,60,141,58,143,58,136,55,138,53,137,55,141,53,143,52,140,50,142,50,153,47,154,47,162,51,165,54,162,54,166,58,170,58,174,61,177,60,183,64,189]],["Bulgaria",[123,63,128,65,127,68,124,69]],["Canada",[19,56,18,53,19,45,21,43,20,36,17,35,26,20,28,21,34,20,40,23,46,23,52,24,53,21,55,17,56,24,58,21,60,21,58,26,56,26,47,35,46,41,52,45,51,50,53,50,54,45,57,42,57,38,59,32,63,35,63,38,66,37,67,44,69,48,68,54,70,56,68,59,65,58,68,51,64,54,60,53,57,58,61,55,61,59,63,62,59,65,58,59,55,62,53,62,46,68,49,62,47,60,45,55,43,57,41,56,255,54,30,56,26,58,31,255,60,29,63,30,66,34,67,30,66,26,69,28,71,25,65,15,59,15,57,19,64,21,64,24,255,40,21,49,21,49,15,45,16,42,13,37,17,41,18,255,59,13,64,13,68,9,79,3,69,3,61,7,63,9,255,46,12,51,13,52,11,255,51,17,53,18,55,13,255,43,11,45,11,47,9,255,56,7,57,9,58,8,255,55,15,57,14,57,16,255,54,11,57,11,55,13,255,50,22,51,20,52,22]],["Chile",[54,186,51,177,51,213,56,241,61,244,60,240,57,239,55,235,56,232,53,216,53,205,52,198]],["China",[169,55,168,59,166,58,167,62,165,62,166,68,162,72,164,78,168,80,167,87,175,94,176,96,179,99,180,105,181,95,183,94,184,97,183,100,187,106,190,101,192,106,194,107,200,100,201,90,199,82,198,81,199,76,195,74,197,70,198,74,201,69,203,66,202,62,203,62,203,56,200,57,198,54,193,47,191,48,195,52,195,59,197,65,195,68,193,66,188,75,188,80,185,74,185,71,183,73,181,69,180,70,175,62,173,62,171,57]],["Croatia",[118,63,120,61,124,63,121,65,121,70]],["Cuba",[39,104,43,102,48,108,45,108,42,104]],["Czech republic",[117,56,121,55,117,51,116,55]],["Denmark",[113,45,116,45,116,43,114,44,115,40,113,42]],["Ecuador",[41,143,45,144,45,149,41,154]],["Egypt",[126,87,133,88,133,93,131,91,134,103,133,105,126,105]],["Estonia",[124,37,126,37,126,40,124,39]],["Finland",[121,21,123,22,125,20,128,32,126,35,122,36,122,31,123,27]],["France",[109,52,111,54,113,55,112,58,111,60,112,61,112,64,113,64,111,66,110,65,109,67,106,66,106,61,105,58,104,57,104,55,106,56,106,54,107,55,109,52]],["Germany",[112,54,112,47,113,45,116,46,117,47,117,51,116,58,112,57,113,55]],["Greece",[122,72,124,69,127,67,130,70,131,78,127,77,127,70,124,71,124,78]],["Hungary",[120,61,119,60,119,57,123,57,122,61]],["Iceland",[93,27,99,25,100,28,96,31,94,29]],["India",[163,81,166,82,170,90,169,93,176,96,176,101,174,102,176,105,175,108,170,116,171,121,170,128,168,130,164,112,164,104,163,107,161,104,162,103,159,100,161,89]],["Indonesia",[183,135,185,136,192,150,191,156,255,192,158,200,161,198,157,192,156,255,203,162,204,163,255,215,156,32,255,210,150,212,151,255,209,151,255,208,148,255,210,146,255,210,142,210,143,209,144,255,207,142,203,143,203,156,204,151,206,155,205,149,206,146,204,147,204,145,207,144,255,195,142,199,142,201,140,201,143,199,152,195,150,255,206,163,209,161,255,220,161,217,159,218,155,213,152,212,146,215,146,216,150,217,147,220,149]],["Iran",[138,69,139,77,144,87,144,89,146,90,147,94,150,96,151,95,153,98,153,93,153,88,154,87,153,82,154,78,149,74,146,78,143,74,142,72,141,73]],["Iraq",[139,77,144,87,142,92,137,86,137,83]],["Ireland",[102,44,103,48,100,51,101,46]],["Israel",[134,90,134,84,133,84,133,88]],["Italy",[113,65,111,61,116,58,117,62,116,64,120,71,118,77,116,75,119,72,114,64,255,113,70,114,70,114,73,113,73]],["Jamaica",[43,112,46,113,44,115]],["Japan",[208,88,206,84,207,80,210,79,211,76,211,68,213,73,214,80,211,83,208,82,255,210,68,210,62,213,64,213,67]],["Lebanon",[133,84,134,81,135,82,134,84]],["Lithuania",[121,45,123,46,123,44]],["Luxembourg",[112,53,112,54,111,54]],["Macedonia",[123,70,123,67,124,66,125,68]],["Madagascar",[146,167,144,174,142,175,141,185,141,190,143,191,147,173]],["Mexico",[16,85,17,94,20,102,18,88,19,87,21,98,23,105,22,108,25,112,32,117,34,115,34,112,37,111,37,105,34,106,34,111,31,111,29,105,30,97,29,96,28,90,25,92,24,86,21,87,18,84]],["Monaco",[112,65]],["Morocco",[99,93,96,94,102,79,105,81,106,86]],["Nepal",[176,97,169,93,170,89,176,94]],["Netherlands",[112,51,110,50,111,48,112,48]],["New zealand",[227,229,235,219,236,221,229,230,255,237,220,237,216,239,214,239,208,240,214,242,214]],["North korea",[199,70,202,76,204,75,202,71,204,65]],["Norway",[111,33,115,29,119,20,126,19,125,21,123,23,121,21,117,27,115,38,112,40]],["Palestine",[133,87,134,89,134,84,133,84]],["Paraguay",[57,185,57,180,60,181,61,185,64,189,63,194,61,195,61,191,58,189,57,186]],["Peru",[41,151,42,154,45,149,45,144,47,149,49,149,50,153,47,154,47,162,50,165,51,168,51,178,46,173,42,158,40,156]],["Philippines",[202,110,204,111,204,118,206,120,202,119,255,206,124,205,126,206,128,255,205,131,206,129,208,127,208,135]],["Poland",[117,47,117,51,121,55,124,54,123,46,120,45]],["Portugal",[100,68,102,68,101,76,100,76]],["Romania",[122,61,123,58,126,57,128,64,123,65]],["Qatar",[146,100,147,96,147,100]],["Russia",[142,69,134,63,135,57,136,56,135,54,132,52,131,50,129,50,130,47,128,45,128,43,126,43,126,35,128,32,125,22,127,20,133,24,132,26,129,26,130,29,131,27,133,29,133,27,135,25,134,22,136,22,136,24,140,22,144,22,144,20,146,20,149,23,147,19,148,16,149,16,152,23,151,26,153,25,153,22,151,18,155,17,154,15,157,14,157,12,163,10,164,9,170,12,168,15,178,15,182,16,184,19,184,17,188,18,188,16,196,19,201,19,203,21,209,22,207,20,216,22,223,26,224,29,219,27,218,29,221,32,218,33,218,35,214,36,214,39,217,44,217,52,212,43,211,40,212,38,212,34,210,35,209,33,207,36,209,38,206,38,204,37,200,38,199,45,201,47,204,47,207,56,205,67,203,66,202,61,204,62,203,56,200,57,197,54,194,48,190,48,190,54,187,53,186,55,183,55,182,53,179,53,178,50,176,50,176,53,172,52,169,55,165,51,163,52,159,45,158,48,155,44,149,47,150,52,146,52,142,50,140,55,142,60,141,63,143,69,255,205,46,209,60,209,54]],["Saudi arabia",[134,92,137,86,145,95,146,100,147,100,151,105,148,111,140,114]],["Singapore",[189,141,191,141,190,143]],["Slovakia",[119,57,123,57,124,54,120,55]],["Slovenia",[115,58,116,58,116,60]],["South africa",[119,197,122,197,122,190,123,194,125,191,126,192,129,185,131,186,132,195,128,205,122,208,120,207,121,203]],["South korea",[202,76,204,75,205,80,203,82]],["Spain",[100,68,101,65,109,67,105,77,101,77,102,68]],["Sweden",[121,21,123,27,119,32,120,38,118,43,116,44,115,38,116,30,119,22]],["Switzerland",[111,60,113,57,115,59,113,61]],["Taiwan",[202,98,201,102,202,105,203,99]],["Tunisia",[113,76,115,78,115,86,114,89,112,82]],["Turkey",[130,70,131,78,140,77,138,69]],["Ukraine",[129,49,136,54,135,58,131,63,129,60,128,62,126,57,123,57,124,51,128,51]],["Uruguay",[62,207,62,205,62,200,66,205,65,209]],["United arab emirates",[151,104,150,97,148,101]],["United kingdom",[103,53,108,52,106,40,104,38,104,44,105,47,255,103,46,104,46,103,44,102,44]],["U.s.a.",[20,56,40,55,43,57,41,60,46,60,44,62,42,68,44,67,46,62,47,63,46,67,58,59,59,62,55,65,55,68,52,70,50,75,48,81,44,86,43,91,44,97,42,99,42,92,40,89,37,89,37,92,34,90,30,93,30,97,28,90,25,92,24,87,20,86,18,84,16,85,15,81,14,71,19,57,255,19,45,18,37,13,34,10,37,11,34,2,42,5,38,2,36,2,34,9,29,6,28,6,26,10,26,10,22,19,18,26,21,17,35,20,36,21,43]],["Venezuela",[48,124,47,128,48,132,52,134,51,140,53,144,54,141,54,137,56,138,57,136,57,133,58,129,56,125,54,126,50,123,49,125]],["Vatican city",[116,66]],["Vietnam",[188,105,190,103,192,106,191,110,194,118,194,124,191,130,191,125,193,122,192,117,192,116,188,104]],["Guyana",[58,130,57,133,57,136,58,137,58,141,59,142,60,133,255]],["Libya",[116,102,114,96,114,87,116,84,118,85,122,90,122,85,124,84,126,87,126,107,125,109,119,102,118,103]]],[["Afghanistan",[153,91,161,88,163,81,167,83,168,80,163,77,161,77,159,77,156,76,155,80,153,80,153,83,154,87,153,89,153,91]],["Andorra",[108,67]],["Albania",[121,65,123,69,122,72,121,70]],["Belarus",[123,47,127,43,128,43,129,46,130,47,129,50,124,51]],["Bosnia and herzegovina ",[123,63,121,65,123,69]],["Burkina faso",[102,124,106,116,108,122,106,125,104,125,104,127]],["Cameroon",[113,136,118,123,118,134,120,142,114,141]],["Central african republic",[118,131,119,140,122,135,128,135,125,125]],["Republic of the congo ",[121,136,120,151,116,156,115,151,118,148,118,141,120,142,119,140]],["Democratic republic of the congo ",[116,156,120,151,121,136,128,135,131,139,129,150,131,159,129,161,130,169,124,164,124,158,122,157,122,159,120,159,119,155]],["Cote d'ivoire",[100,136,100,125,104,127,104,136]],["Costa rica",[37,124,39,125,40,130,37,126]],["Colombia",[42,143,44,137,43,131,46,124,49,122,47,127,48,132,52,134,51,140,50,142,50,152,49,149,47,149,45,144]],["Bolivia",[54,185,51,177,51,167,50,164,52,164,54,162,54,166,58,170,58,174,61,177,60,181,59,180,57,181,57,185,54,184,53,186]],["Cabo verde",[86,117,255,88,117,255,88,115,255,88,114,255,87,114,255,86,113]],["Cyprus",[131,80,133,80,132,82]],["Benin",[107,124,108,133,109,133,109,121,255]],["Cambodia",[192,118,189,118,188,122,190,126,193,122]],["Dominica",[57,117]],["Dominican republic",[49,108,49,112,52,110]],["Equatorial guinea",[114,141,116,141,115,144,114,143,255,113,138]],["Guatemala",[32,117,35,113,36,116,34,119]],["Haiti",[49,112,49,109,48,109,47,112]],["Honduras",[36,116,39,116,40,118,36,121,35,118]],["Jordan",[134,90,134,84,137,83,137,86,134,92]],["Kazakhstan",[142,60,140,55,142,50,146,52,150,52,149,47,155,44,158,48,159,45,163,52,165,51,169,55,168,59,166,58,167,62,165,62,166,67,161,65,161,67,159,67,158,70,156,69,155,65,152,65,149,61,148,63,148,69,146,67,143,63,145,62,145,59,144,59]],["Kosovo",[122,67,123,67,123,69]],["Kuwait",[142,92,144,93,144,88]],["Laos",[186,106,188,104,192,116,192,119,190,117,189,111,187,112,186,108]],["Kenya",[138,153,134,147,134,136,140,137,140,148]],["Malaysia",[187,133,189,133,190,140,188,137,255,194,144,199,142,201,134,200,132,195,142]],["Mali",[101,99,103,99,110,111,109,116,106,116,102,124,104,127,97,123,97,117,102,116]],["Malta",[118,79]],["Moldova",[127,61,255,56,129,59]],["Pakistan",[153,91,161,88,159,99,153,98]],["Panama",[39,130,40,128,43,128,44,129,43,132,42,129,41,131]],["San marino",[116,64]],["Senegal",[93,115,95,114,97,118,97,122,93,122,95,120,92,118]],["Serbia",[122,67,124,66,123,63,121,65]],["Seychelles",[151,153]],["Somalia",[140,148,140,137,145,131,140,125,147,123,145,138]],["Sri lanka",[171,127,171,135,173,132]],["Sudan",[126,104,125,109,124,119,125,127,134,127,137,112,136,110,135,103,133,105]],["Tanzania",[132,149,130,154,132,162,134,163,134,166,139,165,137,153,134,148]],["Thailand",[186,108,184,109,186,122,185,130,187,133,189,133,186,127,187,120,189,122,189,118,190,117,189,111,187,112,186,108]],["Yemen",[140,114,148,111,149,114,142,122,140,114]],["Zimbabwe",[127,178,130,173,133,176,132,185,129,185,127,178]]],[["Antigua and barbuda",[56,113]],["Armenia",[139,71,141,71,140,69,139,69]],["Azerbaijan",[140,69,142,73,144,73,143,68]],["Angola",[116,155,120,156,120,159,122,159,122,158,124,158,124,164,126,165,125,169,124,169,124,175,125,177,116,176,117,164]],["Bahamas",[45,99,45,101,255,46,98]],["Bahrain",[146,96]],["Bangladesh",[176,97,175,102,176,105,179,103,180,106,179,98]],["Barbados",[58,121]],["Belize",[35,112,37,111,35,116]],["Bhutan",[176,94,177,92,178,94]],["Botswana",[126,178,123,179,122,190,123,194,125,191,127,192,129,185]],["Brunei",[198,136,199,137,199,135]],["Burundi",[129,150,131,150,130,153]],["Chad",[119,102,118,103,119,114,117,119,119,131,125,124,124,119,125,115,125,108]],["Comoros",[141,166]],["Djibouti",[141,122,141,124,140,122]],["El salvador",[34,119,35,118,36,121]],["Eritrea",[137,113,136,115,136,118,138,119,140,122,141,122,138,116]],["Ethiopia",[137,112,133,130,135,136,140,137,145,130,140,125,138,119,135,118]],["Fiji",[248,177,249,177,249,179,255,250,175]],["Gabon",[114,143,115,144,116,142,117,142,118,143,118,149,115,151,113,147]],["Gambia",[93,119,95,120,93,121]],["Georgia",[136,64,141,67,141,69,138,69]],["Ghana",[104,135,104,125,106,125,107,134]],["Grenada",[57,122]],["Guinea",[94,125,95,122,99,123,100,131,98,129,97,127,95,128]],["Guinea-bissau",[94,124,95,122,93,122]],["Kiribati",[251,158,255,250,32,255,251,161]],["Kyrgyzstan",[159,67,161,67,161,65,166,67,166,68,162,72,162,73,159,72,161,70,159,68]],["Latvia",[124,39,126,41,127,43,126,45,124,42,122,43,122,40,124,41]],["Lesotho",[129,197,127,199,128,201,129,199]],["Liberia",[97,132,98,129,99,131,100,130,100,137,255]],["Liechtenstein",[114,58]],["Malawi",[133,163,133,170,134,176,135,174,134,163]],["Maldives",[166,135,255,165,138,255,166,139,255,165,141,255,165,144]],["Marshall islands",[241,128,255,243,132,255,244,134,255,244,129,255,245,132,255,245,135]],["Mauritania",[93,106,96,106,97,97,100,96,103,99,101,99,102,116,96,117,95,114,93,115]],["Mauritius",[152,182]],["Micronesia",[223,120]],["Mongolia",[169,55,172,52,176,53,176,50,178,50,179,53,182,53,183,55,186,55,187,53,190,54,190,48,195,52,195,58,197,65,195,68,193,66,188,75,188,78,188,79,185,74,185,71,183,73,181,69,180,70,175,62,173,62,171,57]],["Montenegro",[121,69,122,68,121,66,121,67]],["Mozambique",[134,166,135,174,134,176,133,170,131,172,131,174,133,176,132,185,130,186,132,193,135,187,134,182,139,174,139,166,255]],["Myanmar",[183,93,179,105,182,116,184,114,186,125,186,122,184,109,186,107,183,93]],["Namibia",[116,176,127,177,123,179,122,197,119,197]],["Nauru",[239,148]],["Nicaragua",[36,121,40,117,39,124,37,124]],["Niger",[106,116,108,122,111,119,117,120,119,114,118,104,116,102,110,110,109,116,106,117]],["Nigeria",[109,123,109,121,111,119,117,120,118,124,113,136,111,136,109,132]],["Oman",[149,114,148,111,151,105,151,100,154,104,152,111,149,114]],["Palau",[215,131]],["Papua new guinea",[220,150,220,161,223,159,228,165,225,157,230,154,228,150,229,153,225,156,220,148]],["Rwanda",[130,149,132,149,132,147,130,147]],["Saint kitts and nevis",[56,112]],["Saint lucia",[57,119]],["Saint vincent and the grenadines",[57,121]],["Samoa",[253,172]],["Sao tome and principe",[112,145]],["Sierra leone",[95,128,97,127,98,129,97,133]],["Solomon islands",[237,164,255,236,161,255,235,162,255,235,159,234,158,255,233,32]],["South sudan",[125,127,134,127,135,136,131,139,255]],["Suriname",[58,130,56,135,59,143,62,140,62,134]],["Swaziland",[132,195,131,194,131,192]],["Syria",[134,78,139,77,137,83,134,83]],["Tajikistan",[158,76,157,73,159,69,159,72,162,73,164,78]],["Timor-leste",[207,161,207,163,209,159]],["Togo",[107,134,106,125,107,124,108,133,255]],["Tonga",[253,184]],["Trinidad and tobago",[57,122]],["Turkmenistan",[148,77,146,66,149,69,150,67,157,76,154,80,149,75]],["Tuvalu",[252,32]],["Uganda",[131,140,134,138,134,145,132,148,129,150,131,139,255]],["Uzbekistan",[148,68,148,64,149,61,152,65,155,65,156,69,158,70,159,67,161,70,159,71,159,70,157,73,158,76,157,76,150,67,149,69]],["Vanuatu",[240,172,240,175,255,241,174,255,241,177,255,241,179,255,241,181,255,241,182]],["Zambia",[127,178,125,177,124,175,124,170,125,169,126,166,130,169,129,161,131,159,132,162,133,163,133,171,130,173,127,178]]],[["Z",[72,9,77,7,80,4,85,4,90,2,96,2,103,4,98,8,99,9,97,15,94,16,96,18,89,23,87,26,83,27,82,31,81,32,80,36,78,34,77,34,76,28,76,23,78,21,78,19,79,19,77,17,78,13,74,11]],["Z",[93,106,96,106,97,97,100,97,99,93]],["Z",[62,134,62,141,63,141,64,137]],["Z",[19,80,22,99,30,97,34,82,255,45,128,41,154,52,178,52,201,65,202,60,133,47,125,255,98,90,93,114,100,134,115,131,115,149,120,170,117,176,126,198,133,183,138,165,137,149,146,128,114,94,113,81,102,84,255,109,53,114,47,195,42,205,62,191,75,192,106,183,111,177,100,175,106,154,97,146,58,129,57,124,70,115,59]]]],[[["Hawaii",[5,241,8,245,4,248,255,4,237,3,232]],["Alaska",[48,8,63,8,74,31,79,37,76,50,67,44,59,19]],["Washington",[93,87,98,88,98,84,115,83,116,106,107,107,99,111,99,107,96,105]],["Nevada",[107,137,124,138,123,180,121,180,122,188,108,161]],["New mexico",[137,174,154,174,154,207,144,207,144,209,140,209,140,212,138,211]],["New york",[237,114,236,145,233,141,232,137,219,136,222,130,221,124,228,124,229,120,233,113]],["Florida",[195,219,195,215,205,214,205,217,213,217,213,215,215,215,219,240,218,249,215,249,211,235,211,228,207,220,204,223,201,219]],["Illinois",[189,134,199,134,198,141,197,167,193,174,192,169,190,165,190,161,187,152,188,141,190,140]],["Ohio",[206,139,213,142,217,137,217,152,212,164,207,161,205,153]],["Rhode island",[241,143,241,137,244,137,245,142]],["South carolina",[216,207,214,198,209,191,210,188,219,187,223,196]],["Texas",[144,209,144,207,154,207,154,178,163,177,163,191,173,196,177,195,180,198,180,210,181,214,180,223,172,231,170,241,171,247,165,244,164,236,159,223,155,222,154,228,150,223,149,217]],["Utah",[123,174,124,138,132,138,132,145,138,145,137,174]],["Virginia",[209,176,213,170,217,173,220,162,224,157,229,168,230,177]],["West virginia",[217,173,213,170,212,164,217,152,217,155,220,155,220,158,224,155,224,157,220,162]],["Pennsylvania",[217,137,219,136,232,137,233,141,234,142,232,146,234,152,231,154,217,155]],["Massachusetts",[236,132,245,132,246,137,236,137]],["North carolina",[206,188,215,176,230,177,231,183,228,190,223,196,219]],["Alabama",[195,215,196,188,203,188,205,207,205,214]],["California",[107,137,108,161,122,188,123,193,122,204,115,204,112,195,105,192,99,166,94,150,95,137]],["Colorado",[138,145,157,145,157,174,137,174]],["Georgia",[203,188,210,187,209,191,214,198,216,207,215,215,213,215,213,217,205,217,205,206]],["Michigan",[198,140,201,130,201,117,205,109,210,113,212,128,209,141,255,198,112,189,100,196,93,200,103,205,99,209,108,202,107]]],[["North dakota",[152,84,171,84,173,107,151,107]],["Montana",[118,84,118,91,127,119,133,114,152,114,152,84]],["Nebraska",[152,145,157,145,157,152,176,152,172,132,167,130,152,130]],["Arizona",[122,204,123,193,121,180,123,180,123,174,137,174,138,211]],["Arkansas",[178,196,180,198,180,201,188,201,192,181,190,181,190,177,178,177]],["New hampshire",[243,113,240,132,244,132,244,112]],["New jersey",[233,159,231,154,234,152,232,147,234,142,236,145,235,157]],["Connecticut",[236,145,241,143,241,137,236,137]],["Delaware",[231,154,231,163,233,163,233,159]],["Oklahoma",[154,178,154,174,178,174,178,196,177,195,173,196,163,191,163,177]],["Idaho",[115,83,118,84,118,91,127,119,132,115,132,138,115,138,115,119,117,111,116,106]],["Oregon",[96,105,99,107,99,111,108,107,116,106,117,111,115,119,115,138,95,137,94,130]],["Indiana",[198,139,197,167,199,169,206,158,205,154,206,140]],["Iowa",[172,132,173,126,187,126,190,140,188,141,187,149,186,148,175,148]],["Kansas",[157,174,157,152,176,152,178,163,178,174]],["South dakota",[152,107,152,130,167,130,172,133,173,126,173,107]],["Kentucky",[193,177,193,174,197,167,199,169,206,158,207,161,212,164,213,170,209,176,196,176,196,178]],["Tennessee",[190,179,193,177,196,178,196,176,215,176,206,188,191,188,192,181,190,181]],["Louisiana",[188,201,186,214,191,214,193,221,190,226,180,222,181,214,180,211,180,201]],["Maine",[244,131,244,112,249,94,253,98,253,118,246,124]],["Maryland",[231,154,220,155,220,159,224,155,224,158,231,172,233,163,231,163]],["Vermont",[237,114,243,114,240,132,236,132]],["Minnesota",[173,126,173,107,171,84,178,84,192,90,183,107,183,117,188,124,187,126]],["Mississippi",[190,188,196,188,195,220,192,220,191,214,186,214]],["Wisconsin",[183,107,188,98,199,114,197,134,189,134,187,127,188,124,183,117]],["Missouri",[175,148,186,148,187,150,190,162,190,165,192,168,193,176,190,180,190,177,178,177,178,163]],["Wyoming",[132,114,152,114,152,145,132,145]]],[["Z",[115,204,122,204,140,212,140,209,144,209,149,217,150,223,154,228,155,222,159,223,164,236,165,244,171,247,170,249,138,249,136,243,133,237,128,225,126,212,121,210,122,221,127,232,132,249,129,249,127,243,120,234,123,233,124,231,118,221]],["Z",[63,8,177,7,178,16,182,16,184,29,189,26,196,33,205,42,212,42,212,50,213,60,219,68,223,61,220,46,228,38,228,24,223,15,225,10,249,11,253,20,253,81,247,88,244,99,249,89,253,84,253,116,253,98,249,94,244,113,237,114,233,113,228,123,221,124,217,131,217,133,210,138,212,129,214,126,215,112,219,118,217,107,207,104,205,98,205,91,202,90,200,85,192,90,178,84,98,84,98,87,93,87,83,71,88,72,76,49,79,37,74,31]]]]]

// Context2d
h = $.getContext("2d");

// Math
m = Math;

// Game state
n = 0;

// Frame counter
o = 0;

// Puzzle score
p = 50000;

// Current level score
q = 30000;

// Total score
r = 0;

// Stars position and size
s = []; for(i = 0; i < 300; i++) s[i] = [m.random() * 1200*2/3, m.random() * 650*2/3, m.random() + .5];

// Text
t = function(x, y, text, size, color, align){
    size = size || 50*2/3;
    color = color || "#fff";
    align = align || "center";
    h.setLineDash([0,0]);
    h.setLineDash([]);
    h.textAlign = align;
    h.fillStyle = color;
    h.font = size + "px Impact, impactreg, Charcoal";
    h.strokeStyle = "#000";
    h.strokeText(text, x, y);
    h.fillText(text, x, y);
}

// Stars scroll offset
u = 0;

// Earth rotation offset
v = 0;

// Time out
z = 0;

// Current level / puzzle
A = 0;
B = 0;

// Capitols - country map
D = {"Algiers":"Algeria","Buenos aires":"Argentina","Canberra":"Australia","Vienna":"Austria","Brussels":"Belgium","Brasilia":"Brazil","Sofia":"Bulgaria","Ottawa":"Canada","Santiago":"Chile","Beijing":"China","Zagreb":"Croatia","Havana":"Cuba","Prague":"Czech republic","Copenhagen":"Denmark","Quito":"Ecuador","Cairo":"Egypt","Tallinn":"Estonia","Helsinki":"Finland","Paris":"France","Berlin":"Germany","Athens":"Greece","Budapest":"Hungary","Reykjavik":"Iceland","New delhi":"India","Jakarta":"Indonesia","Tehran":"Iran","Baghdad":"Iraq","Dublin":"Ireland","Jerusalem":"Israel","Rome":"Italy","Kingston":"Jamaica","Tokyo":"Japan","Beirut":"Lebanon","Vilnius":"Lithuania","Luxembourg":"Luxembourg","Skopje":"Macedonia","Antananarivo":"Madagascar","Mexico city":"Mexico","Monaco":"Monaco","Rabat":"Morocco","Kathmandu":"Nepal","Amsterdam":"Netherlands","Wellington":"New zealand","Pyongyang":"North korea","Oslo":"Norway","Ramallah":"Palestine","Asunción":"Paraguay","Lima":"Peru","Manila":"Philippines","Warsaw":"Poland","Lisbon":"Portugal","Bucharest":"Romania","Doha":"Qatar","Moscow":"Russia","Riyadh":"Saudi arabia","Singapore":"Singapore","Bratislava":"Slovakia","Ljubljana":"Slovenia","Pretoria":"South africa","Seoul":"South korea","Madrid":"Spain","Stockholm":"Sweden","Bern":"Switzerland","Taipei":"Taiwan","Tunis":"Tunisia","Ankara":"Turkey","Kyiv":"Ukraine","Montevideo":"Uruguay","Abu dhabi":"United arab emirates","London":"United kingdom","Washington d.c.":"U.s.a.","Caracas":"Venezuela","Vatican city":"Vatican city","Hanoi":"Vietnam","Georgetown":"Guyana","Tripoli":"Libya","Kabul":"Afghanistan","Andorra la vella":"Andorra","Tirana":"Albania","Minsk":"Belarus","Sarajevo":"Bosnia and herzegovina ","Ouagadougou":"Burkina faso","Yaoundé":"Cameroon","Bangui":"Central african republic","Brazzaville":"Republic of the congo ","Kinshasa":"Democratic republic of the congo ","Yamoussoukro":"Cote d'ivoire","San jose":"Costa rica","Bogotá":"Colombia","La paz":"Bolivia","Praia":"Cabo verde","Nicosia":"Cyprus","Porto-novo":"Benin","Phnom penh":"Cambodia","Roseau":"Dominica","Santo domingo":"Dominican republic","Malabo":"Equatorial guinea","Guatemala city":"Guatemala","Port-au-prince":"Haiti","Tegucigalpa":"Honduras","Amman":"Jordan","Astana":"Kazakhstan","Pristina":"Kosovo","Kuwait city":"Kuwait","Vientiane":"Laos","Nairobi":"Kenya","Kuala lumpur":"Malaysia","Bamako":"Mali","Valletta":"Malta","Chisinau":"Moldova","Islamabad":"Pakistan","Panama city":"Panama","San marino":"San marino","Dakar":"Senegal","Belgrade":"Serbia","Victoria":"Seychelles","Mogadishu":"Somalia","Sri jayawardenepura kotte":"Sri lanka","Khartoum":"Sudan","Dodoma":"Tanzania","Bangkok":"Thailand","Sana'a":"Yemen","Harare":"Zimbabwe","Saint john's":"Antigua and barbuda","Yerevan":"Armenia","Baku":"Azerbaijan","Luanda":"Angola","Nassau":"Bahamas","Manama":"Bahrain","Dhaka":"Bangladesh","Bridgetown":"Barbados","Belmopan":"Belize","Thimphu":"Bhutan","Gaborone":"Botswana","Bandar seri begawan":"Brunei","Bujumbura":"Burundi","N'djamena":"Chad","Moroni":"Comoros","Djibouti":"Djibouti","San salvador":"El salvador","Asmara":"Eritrea","Addis ababa":"Ethiopia","Suva":"Fiji","Libreville":"Gabon","Banjul":"Gambia","Tbilisi":"Georgia","Accra":"Ghana","St. george's":"Grenada","Conakry":"Guinea","Bissau":"Guinea-bissau","South tarawa":"Kiribati","Bishkek":"Kyrgyzstan","Riga":"Latvia","Maseru":"Lesotho","Monrovia":"Liberia","Vaduz":"Liechtenstein","Lilongwe":"Malawi","Male":"Maldives","Majuro":"Marshall islands","Nouakchott":"Mauritania","Port louis":"Mauritius","Palikir":"Micronesia","Ulaanbaatar":"Mongolia","Podgorica":"Montenegro","Maputo":"Mozambique","Naypyidaw":"Myanmar","Windhoek":"Namibia","Yaren district":"Nauru","Managua":"Nicaragua","Niamey":"Niger","Abuja":"Nigeria","Muscat":"Oman","Ngerulmud":"Palau","Port moresby":"Papua new guinea","Kigali":"Rwanda","Basseterre":"Saint kitts and nevis","Castries":"Saint lucia","Kingstown":"Saint vincent and the grenadines","Apia":"Samoa","São tomé":"Sao tome and principe","Freetown":"Sierra leone","Honiara":"Solomon islands","Juba":"South sudan","Paramaribo":"Suriname","Mbabane":"Swaziland","Damascus":"Syria","Dushanbe":"Tajikistan","Dili":"Timor-leste","Lomé":"Togo","Nuku'alofa":"Tonga","Port of spain":"Trinidad and tobago","Ashgabat":"Turkmenistan","Funafuti":"Tuvalu","Kampala":"Uganda","Tashkent":"Uzbekistan","Port vila":"Vanuatu","Lusaka":"Zambia","Honolulu":"Hawaii","Juneau":"Alaska","Olympia":"Washington","Carson city":"Nevada","Santa fe":"New mexico","Albany":"New york","Tallahassee":"Florida","Springfield":"Illinois","Columbus":"Ohio","Providence":"Rhode island","Columbia":"South carolina","Austin":"Texas","Salt lake city":"Utah","Richmond":"Virginia","Charleston":"West virginia","Harrisburg":"Pennsylvania","Boston":"Massachusetts","Raleigh":"North carolina","Montgomery":"Alabama","Sacramento":"California","Denver":"Colorado","Atlanta":"Georgia","Lansing":"Michigan","Bismarck":"North dakota","Helena":"Montana","Lincoln":"Nebraska","Phoenix":"Arizona","Little rock":"Arkansas","Concord":"New hampshire","Trenton":"New jersey","Hartford":"Connecticut","Dover":"Delaware","Oklahoma city":"Oklahoma","Boise":"Idaho","Salem":"Oregon","Indianapolis":"Indiana","Des moines":"Iowa","Topeka":"Kansas","Pierre":"South dakota","Frankfort":"Kentucky","Nashville":"Tennessee","Baton rouge":"Louisiana","Augusta":"Maine","Annapolis":"Maryland","Montpelier":"Vermont","St. paul":"Minnesota","Jackson":"Mississippi","Madison":"Wisconsin","Jefferson city":"Missouri","Cheyenne":"Wyoming"};

// Click coords
X = 0;
Y = 0;

/** Game loop **/
w = function(){
    
    // Reset canvas
    $.width = $.width;
    
    // Welcome screen
    if(n == 0){
        
        // Background
        h.fillRect(0,0,1200*2/3,650*2/3);
        
        // Stars
        u--;
        u %= 1200*2/3;

        for(i = 0; i < 300; i++){
          h.fillStyle = "#fff";
          h.beginPath();
          h.arc(a = s[i][0] + u, b = s[i][1], c = s[i][2] + m.random() * .2, 0, 7);
          h.arc(1200*2/3 + a, b, c, 0, 7);
          h.fill();
        }

        // Earth

        // Background
        h.beginPath();
        gradient = h.createLinearGradient(300,0,600,0);
        gradient.addColorStop(0,"#75D1FF");
        gradient.addColorStop(1,"#3591bF");
        h.fillStyle = gradient;
        h.arc(470*2/3, 260*2/3, 140*2/3, 0, 7);
        h.fill();
        
        // Rotation
        v++;
        v %= 220;
        
        // Draw countries
        h.strokeStyle = "#83864F";
        h.fillStyle = "#95D866";
        
        // Loop on difficulties
        for(i = 4; i--;){
            
            // Loop on countries
            for(j = 0; j < g[3][i].length; j++){
                
                // Current country (avoid the gap fillers)
                if((i == 3 && j == 3)) a = [];
                else a = g[3][i][j][1];
                
                // Loop on coordinates
                for(k = 0; k < a.length; k += 2){
                    
                    // Start new island
                    if(a[k] == 255){
                        k++;
                        h.closePath();
                        h.fill();
                        h.stroke();
                        h.beginPath();
                    }
                    
                    // Hack
                    if(a[k + 1] ==  255){
                        k += 2;
                        h.closePath();
                        h.fill();
                        h.stroke();
                        h.beginPath();
                    }

                    // Current point
                    x = (a[k] - v + 100) / 110;
                    y = (a[k+1] - 120) / 150;
                    
                    while(x > 1) x -= 2;
                    if(x > -1 && x < -.5) x = -0.5;
                    if(x > .5 && x < 1) x = 0.5;
                    
                    // Fix canada & russia
                    if(!k && g[3][i][j][0] != "Russia" && g[3][i][j][0] != "Canada"){
                        if(x < 0) b = -.5;
                        else b = .5;
                    }
                    
                    if(g[3][i][j][0] == "Russia"){
                        b = .5;
                        if(v > 50) b = -.5;
                        if(v > 160) b = .5;
                    }
                    
                    if(g[3][i][j][0] == "Canada"){
                        b = .5;
                        if(v > 160) b = -.5;
                        if(v < 50) b = -.5;
                    }
                    
                    if((x <= -.5 || x >= .5)) x = b;
                    
                    x = m.sin(x * m.PI) * m.cos(y * m.PI / 2);
                    y = m.sin(y * m.PI / 2);
                    x = x * 140 + 470;
                    y = y * 140 + 260;
                    
                    // Start country
                    if(k == 0){
                        h.beginPath();
                        h.moveTo(x*2/3, y*2/3);
                    }
                    
                    // Continue country
                    h.lineTo(x*2/3, y*2/3);
                }
                
                h.closePath();
                h.fill();
                h.stroke();
            }
        }

        // Text
        t(180*2/3, 375*2/3, "GE", 300*2/3);
        t(890*2/3, 375*2/3, "Quiz", 300*2/3);
        t(600*2/3, 570*2/3, "START", 80*2/3);
        t(1045*2/3, 420*2/3, "Maxime EUZIERE", 30*2/3);
        t(1055*2/3, 450*2/3, "Anders KAARE", 30*2/3);
    }
    
    // Level presentation screen
    else if(n == 1){
        
        // Background
        h.fillRect(0, 0, 1200*2/3, 650*2/3);
        
        // Text
        t(600*2/3, 280*2/3, "Level " + (A + 1) + ":", 60*2/3);
        
        t(600*2/3,  360*2/3, [
        "Countries (easy)",
        "Capitols (easy)",
        "Famous places (easy)",
        "Countries (medium)",
        "Capitols (medium)",
        "U.S. states (medium)",
        "Famous places (medium)",
        "U.S. capitols (medium)",
        "World countries (hard)",
        "U.S. states (hard)",
        "Famous places (hard)",
        "U.S. capitols (hard)",
        "Capitols (hard)"
        ][A], 60*2/3);
        
        t(600*2/3, 450*2/3, "START", 30*2/3);
    }
    
    // Puzzle screen
    else if(n == 2 || n == 3){
        
        // Puzzles list
        C = [
            g[3][0],
            g[1][0],
            g[0][0],
            g[3][1],
            g[1][1],
            g[4][0],
            g[0][1],
            g[2][0],
            g[3][2],
            g[4][1],
            g[0][2],
            g[2][1],
            g[1][2]
        ][A];
            
        // Draw US map
        if(A == 5 || A == 7 || A == 9 || A == 11){
            f = 4
        }
        
        // Draw world map
        else{
            f = 3;
        }
            
        // Loop on difficulties
        for(i = g[f].length; i--;){
            
            // Loop on countries
            for(j = 0; j < g[f][i].length; j++){
                
                // Current country
                a = g[f][i][j][1];
                
                // Loop on coordinates
                for(k = 0; k < a.length; k += 2){
                    
                    // Start new island
                    if(a[k] == 255){
                        k++;
                        h.closePath();
                        h.fill();
                        h.stroke();
                        h.beginPath();
                    }
                    
                    // hack
                    if(a[k + 1] == 255){
                        k += 2;
                        h.closePath();
                        h.fill();
                        h.stroke();
                        h.beginPath();
                    }

                    // Current point
                    x = a[k] * (f == 4 ? 4.8 : 4.9);
                    y = a[k + 1] * (f == 4 ? 2.5 : 2.35) + (f == 4 ? 38*2/3 : 98*2/3);
                    if(B == 4 || B == 9){
                        x = 1200 - x;
                        y = 710 - y;
                    }
                    
                    // Start country
                    if(k == 0){
                        h.beginPath();
                        h.strokeStyle = B < 5 ? "#83864F" : "#000";
                        h.fillStyle = B < 5 ? "#95D866" : "#000";
                        "#95D866";
                        h.moveTo(x*2/3, y*2/3);
                    }
                    
                    // Continue country
                    h.lineTo(x*2/3, y*2/3);
                }
                
                h.closePath();
                h.fill();
                h.stroke();
            }
        }
        
        // Time out
        if(n == 2){
            if(o == 0){
                n = 3;
                o = 60;
                z = 1;
            }
        }
        
        // Puzzle feedback
        if(n == 3){
            
            // Draw target
            a = C[B][1];
            //_(C[B]);
            
            // Country / State
            if(A == 0 || A == 3 || A == 5 || A == 8 || A == 9){
                
                // Draw country/state in yellow
                h.fillStyle = "yellow";
                h.beginPath();

                // Loop on coordinates
                for(k = 0; k < a.length; k += 2){
                    
                    // Start new island
                    if(a[k] == 255){
                        k++;
                        h.closePath();
                        h.fill();
                        h.stroke();
                        if(o == 60){
                            if(h.isPointInPath(X, Y)){
                                p = 0;
                                c = [X, Y];
                            }
                        }
                        
                        h.beginPath();
                    }
                    
                    // hack
                    if(a[k + 1] == 255){
                        k += 2;
                        h.closePath();
                        h.fill();
                        h.stroke();
                        if(o == 60){
                            if(h.isPointInPath(X, Y)){
                                p = 0;
                                c = [X, Y];
                            }
                        }
                        h.beginPath();
                    }

                    // Current point
                    x = a[k] * (f == 4 ? 4.8 : 4.9);
                    y = a[k + 1] * (f == 4 ? 2.5 : 2.35) + (f == 4 ? 38*2/3 : 98*2/3);
                    if(B == 4 || B == 9){
                        x = 1200 - x;
                        y = 710 - y;
                    }
                    
                    // Test if it's the closest point to where we clicked
                    if(o == 60){
                        b = m.sqrt(m.pow(x*2/3 - X, 2) + m.pow(y*2/3 - Y, 2));
                        if(b < p){
                            p = b;
                            c = [x*2/3, y*2/3];
                        }
                    }
                    
                    // Start country
                    if(k == 0){
                        h.beginPath();
                        h.moveTo(x*2/3, y*2/3);
                    }
                    
                    // Continue country
                    h.lineTo(x*2/3, y*2/3);

                }
                
                h.closePath();
                h.fill();
                h.stroke();
                if(o == 60){
                    if(h.isPointInPath(X, Y)){
                        p = 0;
                        c = [X, Y];
                    }
                }
            }
            
            // Place / capitol
            else {
                x = a[0] * (f == 4 ? 4.8 : 4.9);
                y = a[1] * (f == 4 ? 2.5 : 2.35) + (f == 4 ? 38 : 65);
                if(B == 4 || B == 9){
                    x = 1200 - x;
                    y = 710 - y;
                }
                    
                h.fillStyle = "yellow";
                h.beginPath();
                h.arc(x*2/3, y*2/3, 10*2/3, 0, 7);
                h.fill();
                
                if(o == 60){
                    b = m.sqrt(m.pow(x*2/3 - X, 2) + m.pow(y*2/3 - Y, 2));
                    p = b;
                    c = [x*2/3, y*2/3];
                }
            }
            
            if(o < 60){
                
                // Tell the country of the current capitol
                if(A == 1 || A == 4 || A == 7 || A == 11 || A == 12){
                    t(600*2/3, 630*2/3, C[B][0].toUpperCase() + " IS THE CAPITOL OF " + D[C[B][0]].toUpperCase(), 40*2/3, "#fff", "center");
                }
            }

            // If not timeout
            if(!z){
                
                // Drop flags, trace red line
                if(p > 5){
                    h.fillStyle = "green";
                    h.strokeStyle = "green";
                    h.beginPath();
                    h.moveTo(c[0], c[1]);
                    h.lineTo((c[0]-1), c[1]);
                    h.lineTo((c[0]-1), (c[1]-40));
                    h.lineTo(c[0], (c[1]-40));
                    h.lineTo((c[0]+20), (c[1]-30));
                    h.lineTo(c[0], (c[1]-20));
                    h.stroke();
                    h.fill();
                    
                    h.save();
                    h.strokeStyle = "red";
                    h.lineWidth = "2";
                    h.setLineDash([5*2/3, 5*2/3]);
                    h.beginPath();
                    h.moveTo(X, Y);
                    h.lineTo(c[0], c[1]);
                    h.stroke();
                    h.restore();
                }
                
                h.setLineDash([0,0]);
                h.setLineDash([]);
                h.fillStyle = "blue";
                h.strokeStyle = "blue";
                h.beginPath();
                h.moveTo(X,Y);
                h.lineTo((X-1), Y);
                h.lineTo((X-1), (Y-40));
                h.lineTo(X, (Y-40));
                h.lineTo((X+20), (Y-30));
                h.lineTo(X, (Y-20));
                h.stroke();
                h.fill();
            }
            
            // Update score
            if(o == 45){
                if(A == 5 || A == 7 || A == 9 || A == 11){
                    e = (p < 100 ? (~~(p/10)) * 100 : (~~(p/100)) * 1000);
                    q -= z ? 5000 : e;
                }
                else{
                    e =  (p < 100 ? (~~(p/4)) * 100 : (~~(p/40)) * 1000);
                    q -= z ? 10000 : e;
                }
            }
            
            // Text
            if(o < 45){
                if(z){
                    t(600*2/3, 350*2/3, "TIME OUT", 100*2/3, B < 5 ? "#000" : "#fff");
                    if(A == 5 || A == 7 || A == 9 || A == 11){
                        t(600*2/3, 400*2/3, "5,000km penalty", 50*2/3, B < 5 ? "#000" : "#fff");
                    }
                    else {
                        t(600*2/3, 400*2/3, "10,000km penalty", 50*2/3, B < 5 ? "#000" : "#fff");
                    }
                }
                else{
                    t(600*2/3, 350*2/3, p > 5 ? e + "km away" : "PERFECT", 100*2/3, B < 5 ? "#000" : "#fff")
                }
            }
            
            
            d = 0;
            
            // Game over
            if(q <= 0){
                q = 0;
                d = 1;
            }
            
            // Go to black screen before next puzzle
            if(o == 0) {
                n = 4;
                o = 15;
            }
        }
        
        // UI
        h.beginPath();
        h.fillStyle = "#000";
        h.rect(0, 0, 1200*2/3, 66*2/3);
        h.fill();
        h.closePath();
        h.beginPath();
        h.fillStyle = "#fff";
        if(n == 2){
            h.rect(0, 60*2/3, o * 4*2/3, 5*2/3);
            h.fill();
        }
        h.closePath();
        
        t(100*2/3, 45*2/3,
        [
            "Country",
            "Capitol",
            "Place",
            "Country",
            "Capitol",
            "U.S. state",
            "Place",
            "U.S. capitol",
            "Country",
            "U.S. state",
            "Place",
            "U.S. capitol",
            "Capitol"
        ][A]
        
        + ": " + 
        
        C[B][0].toUpperCase(), 40*2/3, 0, "left");
        
        t(1190*2/3, 45*2/3, q + "km remaining", 40*2/3, 0, "right");
    }
    
    // Black screen between puzzles
    if(n == 4){
        
        // Game over
        if(d){
            n = 5;
        }
        
        // Prepare next screen
        h.fillRect(0,0,1200*2/3,650*2/3);
        if(o == 0){
            
            // Reset click
            X = 0;
            Y = 0;
            
            // Next puzzle
            B++;
            n = 2;
            p = 50000;
            o = 300;
            z = 0;
            
            // Or next level
            if(B > 9){
                B = 0;
                A++;
                n = 1;
                r += q;
                q = 30000;
                if(A == 5 || A == 7 || A == 9 || A == 11){
                    q = 15000;
                }
                
                // Or you won
                if(A > 0){
                    n = 5;
                }
                
                // Faster music when we change levels
                M.t *= 1.075;
            }
            
            // Revert music on puzzles 4 and 9 (and revert it back to normal after)
            if(B == 4 || B == 9){
                M.r = true;
            }
            
            else {
                M.r = false;
            }
            
            
            // Black music on puzzles 5 to 9 (and revert it back to normal after)
            if(B >= 4 && B <= 9){
                M.s = 0.0;
                M.h = [60,10];
                M.b = 1.5;
                M.c = 0.6;
            }
            
            else {
                M.s = 0.1;
                M.h = [22,8,9,3,2,1];
                M.b = 1.5;
                M.c = 0.1;
            }
        }
    }
    
    // Game over
    if(n == 5){
        
        h.fillRect(0,0,1200*2/3,650*2/3);
        
        // Text
        t(600*2/3, 280*2/3, A == 1 ? "YOU WON!" : "GAME OVER!");
        
        if(A == 1){
          texta_win();
        }
        
        else{
          texta_close();
        }
        
        if(A == 13) A = 12;
        
        //t(600*2/3,  360*2/3, "Level " + (A + 1) + " ~ total score: " + r + "km", 40*2/3);
        
        t(600*2/3, 450*2/3, "PLAY THE FULL GAME?", 30*2/3);
        
        //t(600*2/3, 450*2/3, "REPLAY?", 30*2/3);
        
        //Z.style.display = "block";
        
    }
    
    // Update frame counter
    if(o) o--;
    
    setTimeout(w, 33);
}


// Launch game
onload = w();


/** Handle Clicks **/
$.onclick = function(a){
    
    // Home screen => Level presentation screen
    if(n == 0){
        n = 1;
        
        music.play();
        
        // Shuffle data now
        b = function(){return .5 - m.random()}
        g[0][0].sort(b); // Places easy
        g[0][1].sort(b); // Places medium
        g[0][2].sort(b); // Places hard
        g[1][0].sort(b); // Capitols easy
        g[1][1].sort(b); // Capitols medium
        g[1][2].sort(b); // Capitols hard
        g[2][0].sort(b); // US capitols easy
        g[2][1].sort(b); // US capitols hard
        g[3][0].sort(b); // Countries easy
        g[3][1].sort(b); // Countries medium
        g[3][2].sort(b); // Countries hard
        g[4][0].sort(b); // US states easy
        g[4][1].sort(b); // US states hard
        //_(g);
    }
    
    // Level presentation screen => Puzzle screen
    else if(n == 1){
        n = 2;
        o = 300;
    }
    
    // Puzzle screen => Puzzle feedback
    else if(n == 2){
        X = a.pageX / (innerWidth / 800);
        Y = a.pageY / (innerWidth / 800);
        n = 3;
        o = 60;
    }
    
    // Game over => replay
    else if(n == 5){
        window.location = "http://xem.github.io/JS13k15/mobile";
    }
    
    // Other game states don't require clicking
}