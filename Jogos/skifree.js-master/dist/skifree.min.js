(function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i})({1:[function(e,t,n){CanvasRenderingContext2D.prototype.storeLoadedImage=function(e,t){this.images||(this.images={}),this.images[e]=t},CanvasRenderingContext2D.prototype.getLoadedImage=function(e){if(this.images[e])return this.images[e]},CanvasRenderingContext2D.prototype.followSprite=function(e){this.centralSprite=e},CanvasRenderingContext2D.prototype.getCentralPosition=function(){return{map:this.centralSprite.mapPosition,canvas:[Math.round(this.canvas.width*.5),Math.round(this.canvas.height*.5),0]}},CanvasRenderingContext2D.prototype.mapPositionToCanvasPosition=function(e){var t=this.getCentralPosition(),n=t.map,r=t.canvas,i=n[0]-e[0],s=n[1]-e[1];return[r[0]-i,r[1]-s]},CanvasRenderingContext2D.prototype.canvasPositionToMapPosition=function(e){var t=this.getCentralPosition(),n=t.map,r=t.canvas,i=r[0]-e[0],s=r[1]-e[1];return[n[0]-i,n[1]-s]},CanvasRenderingContext2D.prototype.getCentreOfViewport=function(){return(this.canvas.width/2).floor()},CanvasRenderingContext2D.prototype.getMiddleOfViewport=function(){return(this.canvas.height/2).floor()},CanvasRenderingContext2D.prototype.getBelowViewport=function(){return this.canvas.height.floor()},CanvasRenderingContext2D.prototype.getMapBelowViewport=function(){var e=this.getBelowViewport();return this.canvasPositionToMapPosition([0,e])[1]},CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfCanvas=function(e){var t=0,n=this.canvas.width;return e&&(t-=e,n+=e),Number.random(t,n)},CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfMap=function(e){var t=this.getRandomlyInTheCentreOfCanvas(e);return this.canvasPositionToMapPosition([t,0])[0]},CanvasRenderingContext2D.prototype.getRandomMapPositionBelowViewport=function(){var e=this.getRandomlyInTheCentreOfCanvas(),t=this.getBelowViewport();return this.canvasPositionToMapPosition([e,t])},CanvasRenderingContext2D.prototype.getRandomMapPositionAboveViewport=function(){var e=this.getRandomlyInTheCentreOfCanvas(),t=this.getAboveViewport();return this.canvasPositionToMapPosition([e,t])},CanvasRenderingContext2D.prototype.getTopOfViewport=function(){return this.canvasPositionToMapPosition([0,0])[1]},CanvasRenderingContext2D.prototype.getAboveViewport=function(){return 0-(this.canvas.height/4).floor()}},{}],2:[function(e,t,n){Function.prototype.method=function(e,t){return this.prototype[e]=t,this},Object.method("superior",function(e){var t=this,n=t[e];return function(){return n.apply(t,arguments)}})},{}],3:[function(e,t,n){var r=e("./spriteArray"),i=e("eventedloop");(function(e){function t(e,t){var n=new r,s=new r,o=new r,u=e.getContext("2d"),a=u.getCentreOfViewport(),f=0,l=!1,c=this,h=[],p=[],d=new i;this.addStaticObject=function(e){n.push(e)},this.addStaticObjects=function(e){e.forEach(this.addStaticObject.bind(this))},this.addMovingObject=function(e,t){t&&n.onPush(function(n){n.data&&n.data.hitBehaviour[t]&&n.onHitting(e,n.data.hitBehaviour[t])},!0),s.push(e)},this.addUIElement=function(e){o.push(e)},this.beforeCycle=function(e){h.push(e)},this.afterCycle=function(e){p.push(e)},this.setMouseX=function(e){a=e},this.setMouseY=function(e){f=e},t.setMapPosition(0,0),t.setMapPositionTarget(0,-10),u.followSprite(t);var v=0;this.cycle=function(){h.each(function(e){e()});var e=u.canvasPositionToMapPosition([a,f]);t.isJumping||t.setMapPositionTarget(e[0],e[1]),v++,t.cycle(),s.each(function(e,t){e.cycle(u)}),n.cull(),n.each(function(e,t){e.cycle&&e.cycle()}),o.each(function(e,t){e.cycle&&e.cycle()}),p.each(function(e){e()})},c.draw=function(){e.width=e.width,t.draw(u),t.cycle(),s.each(function(e,t){e.draw(u)}),n.each(function(e,t){e.draw&&e.draw(u,"main")}),o.each(function(e,t){e.draw&&e.draw(u,"main")})},this.start=function(){d.start()},this.pause=function(){l=!0,d.stop()},this.isPaused=function(){return l},this.reset=function(){l=!1,n=new r,s=new r,a=u.getCentreOfViewport(),f=0,t.reset(),t.setMapPosition(0,0,0),this.start()}.bind(this),d.on("20",this.cycle),d.on("20",this.draw)}e.game=t})(this),typeof t!="undefined"&&(t.exports=this.game)},{"./spriteArray":12,eventedloop:16}],4:[function(e,t,n){(function(e){function t(){var e=function(){return Math.floor(Math.random()*65536).toString(16)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}e.guid=t})(this),typeof t!="undefined"&&(t.exports=this.guid)},{}],5:[function(e,t,n){function r(e){var t=this;return t.lines=e.initialLines,t.top=e.position.top,t.right=e.position.right,t.bottom=e.position.bottom,t.left=e.position.left,t.width=e.width,t.height=e.height,t.setLines=function(e){t.lines=e},t.draw=function(e){e.font="11px monospace";var n=0;t.lines.each(function(r){var i=+e.font.slice(0,2),s=e.measureText(r).width,o=i*1.5,u,a;t.top?a=t.top+n:t.bottom&&(a=e.canvas.height-t.top-o+n),t.right?u=e.canvas.width-t.right-s:t.left&&(u=t.left),n+=o,e.fillText(r,u,a)})},t}typeof t!="undefined"&&(t.exports=r)},{}],6:[function(e,t,n){function r(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}t.exports=r},{}],7:[function(e,t,n){var r=e("./sprite");(function(e){function t(e){function u(e){s+=1,t.isEating=!0,t.isMoving=!1,s<6?setTimeout(function(){u(e)},300):(s=0,t.isEating=!1,t.isMoving=!0,e())}var t=new r(e),n=t.superior("draw"),i=1,s=0,o=6;return t.isEating=!1,t.isFull=!1,t.setSpeed(o),t.draw=function(e){var r=function(){var e=t.movingToward[0]-t.canvasX;if(t.isEating)return"eating"+s;i+.1>2?i=.1:i+=.1;if(e>=0)return"sEast"+Math.ceil(i);if(e<0)return"sWest"+Math.ceil(i)};return n(e,r())},t.startEating=u,t}e.monster=t})(this),typeof t!="undefined"&&(t.exports=this.monster)},{"./sprite":11}],8:[function(e,t,n){(function(){var e,t=function(){},n=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=n.length,i=window.console=window.console||{};while(r--)e=n[r],i[e]||(i[e]=t)})()},{}],9:[function(e,t,n){var r=e("./sprite");typeof navigator!="undefined"?navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate:navigator={vibrate:!1},function(e){function t(e){function b(){n.setSpeed(c),n.isMoving=!0,n.hasBeenHit=!1,n.isJumping=!1,n.isPerformingTrick=!1,u&&clearInterval(u),n.setMapPosition(undefined,undefined,0)}function w(){n.isMoving=!1,n.hasBeenHit=!0,n.isJumping=!1,n.isPerformingTrick=!1,u&&clearInterval(u),n.setMapPosition(undefined,undefined,0)}function E(){var e=n.getSpeed();n.setSpeed(e+2),n.setSpeedY(e+2),n.isMoving=!0,n.hasBeenHit=!1,n.isJumping=!0,n.setMapPosition(undefined,undefined,1)}function S(){if(n.direction)return n.direction<=90?"east":n.direction>90&&n.direction<150?"esEast":n.direction>=150&&n.direction<180?"sEast":n.direction===180?"south":n.direction>180&&n.direction<=210?"sWest":n.direction>210&&n.direction<270?"wsWest":n.direction>=270?"west":"south";var e=n.movingToward[0]-n.mapPosition[0],t=n.movingToward[1]-n.mapPosition[1];return t<=0?e>0?"east":"west":s.esEast(e)?"esEast":s.sEast(e)?"sEast":s.wsWest(e)?"wsWest":s.sWest(e)?"sWest":"south"}function x(e){t[e]&&n.setDirection(t[e]),e==="west"||e==="east"?n.isMoving=!1:n.isMoving=!0}function T(){return"blank"}function N(){return"jumping"}function C(){return console.log("Trick step is",y),y===0?"jumping":y===1?"somersault1":"somersault2"}function k(e,t,r){return r===0||r===1?t:(e<t&&(e+=n.getSpeed()*(r/p)),e>t&&(e-=n.getSpeed()*(r/p)),e)}var t={west:270,wsWest:240,sWest:195,south:180,sEast:165,esEast:120,east:90},n=new r(e),i={draw:n.superior("draw"),cycle:n.superior("cycle"),getSpeedX:n.superior("getSpeedX"),getSpeedY:n.superior("getSpeedY"),hits:n.superior("hits")},s={esEast:function(e){return e>300},sEast:function(e){return e>75},wsWest:function(e){return e<-300},sWest:function(e){return e<-75}},o,u,a=!0,f=[],l=0,c=5,h=2,p=70,d=0,v=0,m=0,g=1,y=0;return n.isMoving=!0,n.hasBeenHit=!1,n.isJumping=!1,n.isPerformingTrick=!1,n.onHitObstacleCb=function(){},n.setSpeed(c),n.reset=function(){f=[],l=0,n.isMoving=!0,n.hasBeenHit=!1,a=!0,b()},n.stop=function(){n.direction>180?x("west"):x("east")},n.turnEast=function(){var e=S();switch(e){case"west":x("wsWest");break;case"wsWest":x("sWest");break;case"sWest":x("south");break;case"south":x("sEast");break;case"sEast":x("esEast");break;case"esEast":x("east");break;default:x("south")}},n.turnWest=function(){var e=S();switch(e){case"east":x("esEast");break;case"esEast":x("sEast");break;case"sEast":x("south");break;case"south":x("sWest");break;case"sWest":x("wsWest");break;case"wsWest":x("west");break;default:x("south")}},n.stepWest=function(){n.mapPosition[0]-=n.speed*2},n.stepEast=function(){n.mapPosition[0]+=n.speed*2},n.setMapPositionTarget=function(e,t){if(n.hasBeenHit)return;Math.abs(n.mapPosition[0]-e)<=75&&(e=n.mapPosition[0]),n.movingToward=[e,t]},n.startMovingIfPossible=function(){!n.hasBeenHit&&!n.isBeingEaten&&(n.isMoving=!0)},n.setTurnEaseCycles=function(e){p=e},n.getPixelsTravelledDownMountain=function(){return l},n.resetSpeed=function(){n.setSpeed(c)},n.cycle=function(){n.getSpeedX()<=0&&n.getSpeedY()<=0&&(n.isMoving=!1),n.isMoving&&(l+=n.speed),n.isJumping&&n.setMapPositionTarget(undefined,n.mapPosition[1]+n.getSpeed()),i.cycle(),n.checkHittableObjects()},n.draw=function(e){var t=function(){return n.isBeingEaten?T():n.isJumping?n.isPerformingTrick?C():N():n.hasBeenHit?"hit":S()};return i.draw(e,t())},n.hits=function(e){return f.indexOf(e.id)!==-1?!1:e.occupiesZIndex(n.mapPosition[2])?i.hits(e)?!0:!1:!1},n.speedBoost=function(){var e=n.speed;a&&(a=!1,n.setSpeed(n.speed*h),setTimeout(function(){n.setSpeed(e),setTimeout(function(){a=!0},1e4)},2e3))},n.attemptTrick=function(){n.isJumping&&(n.isPerformingTrick=!0,u=setInterval(function(){y>=2?y=0:y+=1},300))},n.getStandardSpeed=function(){return c},n.getSpeedX=function(){return S()==="esEast"||S()==="wsWest"?(v=.5,d=k(d,n.getSpeed()*v,v),d):S()==="sEast"||S()==="sWest"?(v=.33,d=k(d,n.getSpeed()*v,v),d):(d=k(d,0,v),d)},n.setSpeedY=function(e){m=e},n.getSpeedY=function(){var e;return n.isJumping?m:S()==="esEast"||S()==="wsWest"?(g=.6,m=k(m,n.getSpeed()*.6,.6),m):S()==="sEast"||S()==="sWest"?(g=.85,m=k(m,n.getSpeed()*.85,.85),m):S()==="east"||S()==="west"?(g=1,m=0,m):(m=k(m,n.getSpeed(),g),m)},n.hasHitObstacle=function(e){w(),navigator.vibrate&&navigator.vibrate(500),f.push(e.id),n.resetSpeed(),n.onHitObstacleCb(e),o&&clearTimeout(o),o=setTimeout(function(){b()},1500)},n.hasHitJump=function(){E(),o&&clearTimeout(o),o=setTimeout(function(){b()},1e3)},n.isEatenBy=function(e,t){n.hasHitObstacle(e),e.startEating(t),f.push(e.id),n.isMoving=!1,n.isBeingEaten=!0},n.reset=function(){f=[],l=0,n.isMoving=!0,n.isJumping=!1,n.hasBeenHit=!1,a=!0},n.setHitObstacleCb=function(e){n.onHitObstacleCb=e||function(){}},n}e.skier=t}(this),typeof t!="undefined"&&(t.exports=this.skier)},{"./sprite":11}],10:[function(e,t,n){var r=e("./sprite");(function(e){function t(e){function o(){var e=t.movingToward[0]-t.mapPosition[0],n=t.movingToward[1]-t.mapPosition[1];return i.sEast(e)?"sEast":"sWest"}var t=new r(e),n={draw:t.superior("draw"),cycle:t.superior("cycle")},i={sEast:function(e){return e>0},sWest:function(e){return e<=0}},s=3;return t.setSpeed(s),t.cycle=function(e){Number.random(10)===1&&(t.setMapPositionTarget(e.getRandomlyInTheCentreOfMap()),t.setSpeed(s+Number.random(-1,1))),t.setMapPositionTarget(undefined,e.getMapBelowViewport()+600),n.cycle()},t.draw=function(e){var t=function(){return o()};return n.draw(e,t())},t}e.snowboarder=t})(this),typeof t!="undefined"&&(t.exports=this.snowboarder)},{"./sprite":11}],11:[function(e,t,n){(function(t){function r(e){function o(e){i.canvasX+=e.toNumber()}function u(e){i.canvasY+=e.toNumber()}function a(t){if(i.data.hitBoxes&&e.hitBoxes[t])return e.hitBoxes[t]}function f(e){return e=Math.round(e*2)/2,e}function l(){if(!i.isMoving)return;var e=i.mapPosition[0],t=i.mapPosition[1];if(typeof i.direction!="undefined"){var n=i.direction-90;n<0&&(n=360+n),e+=f(i.speed*Math.cos(n*(Math.PI/180))),t+=f(i.speed*Math.sin(n*(Math.PI/180)))}else typeof i.movingToward[0]!="undefined"&&(e>i.movingToward[0]?e-=Math.min(i.getSpeedX(),Math.abs(e-i.movingToward[0])):e<i.movingToward[0]&&(e+=Math.min(i.getSpeedX(),Math.abs(e-i.movingToward[0])))),typeof i.movingToward[1]!="undefined"&&(t>i.movingToward[1]?t-=Math.min(i.getSpeedY(),Math.abs(t-i.movingToward[1])):t<i.movingToward[1]&&(t+=Math.min(i.getSpeedY(),Math.abs(t-i.movingToward[1]))));i.setMapPosition(e,t)}var t={},r=[0],i=this,s;return i.direction=undefined,i.mapPosition=[0,0,0],i.id=n(),i.canvasX=0,i.canvasY=0,i.canvasZ=0,i.height=0,i.speed=0,i.data=e||{parts:{}},i.movingToward=[0,0],i.metresDownTheMountain=0,i.movingWithConviction=!1,i.deleted=!1,i.maxHeight=function(){return Object.values(i.data.parts).map(function(e){return e[3]}).max()}(),i.isMoving=!0,i.data.parts||(i.data.parts={}),e&&e.id&&(i.id=e.id),e&&e.zIndexesOccupied&&(r=e.zIndexesOccupied),this.draw=function(e,t){var n=i.data.parts[t];i.height=n[3],i.width=n[2];var r=e.mapPositionToCanvasPosition(i.mapPosition);i.setCanvasPosition(r[0],r[1]),e.drawImage(e.getLoadedImage(i.data.$imageFile),n[0],n[1],n[2],n[3],i.canvasX,i.canvasY,n[2],n[3])},this.setMapPosition=function(e,t,n){typeof e=="undefined"&&(e=i.mapPosition[0]),typeof t=="undefined"&&(t=i.mapPosition[1]),typeof n=="undefined"?n=i.mapPosition[2]:i.zIndexesOccupied=[n],i.mapPosition=[e,t,n]},this.setCanvasPosition=function(e,t){e&&(!Object.isString(e)||e.first()!=="+"&&e.first()!=="-"?i.canvasX=e:o(e)),t&&(!Object.isString(t)||t.first()!=="+"&&t.first()!=="-"?i.canvasY=t:u(t))},this.getCanvasPositionX=function(){return i.canvasX},this.getCanvasPositionY=function(){return i.canvasY},this.getLeftHitBoxEdge=function(e){e=e||0;var t=this.getCanvasPositionX();return a(e)&&(t+=a(e)[0]),t},this.getTopHitBoxEdge=function(e){e=e||0;var t=this.getCanvasPositionY();return a(e)&&(t+=a(e)[1]),t},this.getRightHitBoxEdge=function(e){return e=e||0,a(e)?i.canvasX+a(e)[2]:i.canvasX+i.width},this.getBottomHitBoxEdge=function(e){return e=e||0,a(e)?i.canvasY+a(e)[3]:i.canvasY+i.height},this.getPositionInFrontOf=function(){return[i.canvasX,i.canvasY+i.height]},this.setSpeed=function(e){i.speed=e,i.speedX=e,i.speedY=e},this.incrementSpeedBy=function(e){i.speed+=e},i.getSpeed=function(){return i.speed},i.getSpeedX=function(){return i.speed},i.getSpeedY=function(){return i.speed},this.setHeight=function(e){i.height=e},this.setWidth=function(e){i.width=e},this.getMaxHeight=function(){return i.maxHeight},i.getMovingTowardOpposite=function(){if(!i.isMoving)return[0,0];var e=i.movingToward[0]-i.mapPosition[0],t=i.movingToward[1]-i.mapPosition[1],n=Math.abs(e)>75?0-e:0,r=-t;return[n,r]},this.checkHittableObjects=function(){Object.keys(t,function(e,n){n.object.deleted?delete t[e]:n.object.hits(i)&&n.callbacks.each(function(e){e(i,n.object)})})},this.cycle=function(){i.checkHittableObjects(),s&&i.setMapPositionTarget(s.mapPosition[0],s.mapPosition[1],!0),l()},this.setMapPositionTarget=function(e,t,n){n&&(i.movingWithConviction=!1),i.movingWithConviction||(typeof e=="undefined"&&(e=i.movingToward[0]),typeof t=="undefined"&&(t=i.movingToward[1]),i.movingToward=[e,t],i.movingWithConviction=!1)},this.setDirection=function(e){e>=360&&(e=360-e),i.direction=e,i.movingToward=undefined},this.resetDirection=function(){i.direction=undefined},this.setMapPositionTargetWithConviction=function(e,t){i.setMapPositionTarget(e,t),i.movingWithConviction=!0},this.follow=function(e){s=e},this.stopFollowing=function(){s=!1},this.onHitting=function(e,n){if(t[e.id])return t[e.id].callbacks.push(n);t[e.id]={object:e,callbacks:[n]}},this.deleteOnNextCycle=function(){i.deleted=!0},this.occupiesZIndex=function(e){return r.indexOf(e)>=0},this.hits=function(e){var t=!1,n=!1;return e.getTopHitBoxEdge(i.mapPosition[2])<=i.getBottomHitBoxEdge(i.mapPosition[2])&&e.getBottomHitBoxEdge(i.mapPosition[2])>=i.getBottomHitBoxEdge(i.mapPosition[2])&&(t=!0),e.getTopHitBoxEdge(i.mapPosition[2])<=i.getTopHitBoxEdge(i.mapPosition[2])&&e.getBottomHitBoxEdge(i.mapPosition[2])>=i.getTopHitBoxEdge(i.mapPosition[2])&&(t=!0),e.getLeftHitBoxEdge(i.mapPosition[2])<=i.getRightHitBoxEdge(i.mapPosition[2])&&e.getRightHitBoxEdge(i.mapPosition[2])>=i.getRightHitBoxEdge(i.mapPosition[2])&&(n=!0),e.getLeftHitBoxEdge(i.mapPosition[2])<=i.getLeftHitBoxEdge(i.mapPosition[2])&&e.getRightHitBoxEdge(i.mapPosition[2])>=i.getLeftHitBoxEdge(i.mapPosition[2])&&(n=!0),t&&n},this.isAboveOnCanvas=function(e){return i.canvasY+i.height<e},this.isBelowOnCanvas=function(e){return i.canvasY>e},i}var n=e("./guid");r.createObjects=function(t,n){function i(e){var t=n.position;if(Number.random(100+n.rateModifier)<=e.dropRate){var i=new r(e.sprite);return i.setSpeed(0),Object.isFunction(t)&&(t=t()),i.setMapPosition(t[0],t[1]),e.sprite.hitBehaviour&&e.sprite.hitBehaviour.skier&&n.player&&i.onHitting(n.player,e.sprite.hitBehaviour.skier),i}}Array.isArray(t)||(t=[t]),n=Object.merge(n,{rateModifier:0,dropRate:1,position:[0,0]},!1,!1);var s=t.map(i).remove(undefined);return s},t.sprite=r})(this),typeof t!="undefined"&&(t.exports=this.sprite)},{"./guid":4}],12:[function(e,t,n){(function(e){function t(){return this.pushHandlers=[],this}t.prototype=Object.create(Array.prototype),t.prototype.onPush=function(e,t){this.pushHandlers.push(e),t&&this.each(e)},t.prototype.push=function(e){Array.prototype.push.call(this,e),this.pushHandlers.each(function(t){t(e)})},t.prototype.cull=function(){this.each(function(e,t){if(e.deleted)return delete this[t]})},e.spriteArray=t})(this),typeof t!="undefined"&&(t.exports=this.spriteArray)},{}],13:[function(e,t,n){function C(e,t){function i(){n+=1,n===e.length&&t(r)}var n=0,r={};e.each(function(e){var t=new Image;t.onload=i,t.src=e,d.storeLoadedImage(e,t)})}function k(e,t){t.isEatenBy(e,function(){S-=1,e.isFull=!0,e.isEating=!1,t.isBeingEaten=!1,e.setSpeed(t.getSpeed()),e.stopFollowing();var n=d.getRandomMapPositionAboveViewport();e.setMapPositionTarget(n[0],n[1])})}function L(e){function v(){w=0,S=5,x=localStorage.getItem("highScore"),o.reset(),o.addStaticObject(n)}function m(){o.isPaused()||(x=localStorage.setItem("highScore",w),s.setLines(["Game over!","Hit space to restart"]),o.pause(),o.cycle())}function C(e,t){var n=Math.max(800-p.width,0);Number.random(1e3+n)<=t&&e()}function L(){var e=new u(y.monster),n=d.getRandomMapPositionAboveViewport();e.setMapPosition(n[0],n[1]),e.follow(t),e.setSpeed(t.getStandardSpeed()),e.onHitting(t,k),o.addMovingObject(e,"monster")}function A(){var e=new f(y.snowboarder),n=d.getRandomMapPositionAboveViewport(),r=d.getRandomMapPositionBelowViewport();e.setMapPosition(n[0],n[1]),e.setMapPositionTarget(r[0],r[1]),e.onHitting(t,y.snowboarder.hitBehaviour.skier),o.addMovingObject(e)}var t,n,s,o;t=new l(y.skier),t.setMapPosition(0,0),t.setMapPositionTarget(0,-10),T&&t.setHitObstacleCb(function(){S-=1}),o=new h(p,t),n=new a(y.signStart),o.addStaticObject(n),n.setMapPosition(-50,0),d.followSprite(t),s=new c({initialLines:["SkiFree.js",g,"Travelled 0m","High Score: "+x,"Skiers left: "+S,"Created by Dan Hough (@basicallydan)"],position:{top:15,right:10}}),o.beforeCycle(function(){var e=[];t.isMoving&&(e=a.createObjects([{sprite:y.smallTree,dropRate:N.smallTree},{sprite:y.tallTree,dropRate:N.tallTree},{sprite:y.jump,dropRate:N.jump},{sprite:y.thickSnow,dropRate:N.thickSnow},{sprite:y.rock,dropRate:N.rock}],{rateModifier:Math.max(800-p.width,0),position:function(){return d.getRandomMapPositionBelowViewport()},player:t})),o.isPaused()||(o.addStaticObjects(e),C(A,.1),w=parseFloat(t.getPixelsTravelledDownMountain()/b).toFixed(1),w>E&&C(L,.001),s.setLines(["SkiFree.js",g,"Travelled "+w+"m","Skiers left: "+S,"High Score: "+x,"Created by Dan Hough (@basicallydan)","Current Speed: "+t.getSpeed()]))}),o.afterCycle(function(){S===0&&m()}),o.addUIElement(s),$(p).mousemove(function(e){o.setMouseX(e.pageX),o.setMouseY(e.pageY),t.resetDirection(),t.startMovingIfPossible()}).bind("click",function(e){o.setMouseX(e.pageX),o.setMouseY(e.pageY),t.resetDirection(),t.startMovingIfPossible()}).focus(),i.bind("f",t.speedBoost),i.bind("t",t.attemptTrick),i.bind(["w","up"],function(){t.stop()}),i.bind(["a","left"],function(){t.direction===270?t.stepWest():t.turnWest()}),i.bind(["s","down"],function(){t.setDirection(180),t.startMovingIfPossible()}),i.bind(["d","right"],function(){t.direction===90?t.stepEast():t.turnEast()}),i.bind("m",L),i.bind("b",A),i.bind("space",v);var O=r(p).on("press",function(e){e.preventDefault(),o.setMouseX(e.center.x),o.setMouseY(e.center.y)}).on("tap",function(e){o.setMouseX(e.center.x),o.setMouseY(e.center.y)}).on("pan",function(e){o.setMouseX(e.center.x),o.setMouseY(e.center.y),t.resetDirection(),t.startMovingIfPossible()}).on("doubletap",function(e){t.speedBoost()});t.isMoving=!1,t.setDirection(270),o.start()}function A(){p.width=window.innerWidth,p.height=window.innerHeight}e("./lib/canvasRenderingContext2DExtensions"),e("./lib/extenders"),e("./lib/plugins");var r=e("hammerjs"),i=e("br-mousetrap"),s=e("./lib/isMobileDevice"),o=e("./lib/spriteArray"),u=e("./lib/monster"),a=e("./lib/sprite"),f=e("./lib/snowboarder"),l=e("./lib/skier"),c=e("./lib/infoBox"),h=e("./lib/game"),p=document.getElementById("skifree-canvas"),d=p.getContext("2d"),v=["sprite-characters.png","skifree-objects.png"],m=this,g="Use the mouse or WASD to control the player";s()&&(g="Tap or drag on the piste to control the player");var y=e("./spriteInfo"),b=18,w=0,E=2e3,S=5,x=0,T=!1,N={smallTree:4,tallTree:2,jump:1,thickSnow:1,rock:1};localStorage.getItem("highScore")&&(x=localStorage.getItem("highScore")),window.addEventListener("resize",A,!1),A(),C(v,L),this.exports=window},{"./lib/canvasRenderingContext2DExtensions":1,"./lib/extenders":2,"./lib/game":3,"./lib/infoBox":5,"./lib/isMobileDevice":6,"./lib/monster":7,"./lib/plugins":8,"./lib/skier":9,"./lib/snowboarder":10,"./lib/sprite":11,"./lib/spriteArray":12,"./spriteInfo":14,"br-mousetrap":15,hammerjs:18}],14:[function(e,t,n){(function(e){function n(e){e.deleteOnNextCycle()}function r(e,t){t.deleteOnNextCycle()}function i(e,t){e.hasHitObstacle(t)}function s(e,t){t.hasHitObstacle(e)}function o(e,t){t.hasHitObstacle(e)}function u(e,t){e.hasHitJump(t)}function a(e,t){t.hasHitJump(e)}function f(e,t){t.hasHitObstacle(e)}var t={skier:{$imageFile:"sprite-characters.png",parts:{blank:[0,0,0,0],east:[0,0,24,34],esEast:[24,0,24,34],sEast:[49,0,17,34],south:[65,0,17,34],sWest:[49,37,17,34],wsWest:[24,37,24,34],west:[0,37,24,34],hit:[0,78,31,31],jumping:[84,0,32,34],somersault1:[116,0,32,34],somersault2:[148,0,32,34]},hitBoxes:{0:[7,20,27,34]},id:"player",hitBehaviour:{}},smallTree:{$imageFile:"skifree-objects.png",parts:{main:[0,28,30,34]},hitBoxes:{0:[0,18,30,34]},hitBehaviour:{}},tallTree:{$imageFile:"skifree-objects.png",parts:{main:[95,66,32,64]},zIndexesOccupied:[0,1],hitBoxes:{0:[0,54,32,64],1:[0,10,32,54]},hitBehaviour:{}},thickSnow:{$imageFile:"skifree-objects.png",parts:{main:[143,53,43,10]},hitBehaviour:{}},rock:{$imageFile:"skifree-objects.png",parts:{main:[30,52,23,11]},hitBehaviour:{}},monster:{$imageFile:"sprite-characters.png",parts:{sEast1:[64,112,26,43],sEast2:[90,112,32,43],sWest1:[64,158,26,43],sWest2:[90,158,32,43],eating1:[122,112,34,43],eating2:[156,112,31,43],eating3:[187,112,31,43],eating4:[219,112,25,43],eating5:[243,112,26,43]},hitBehaviour:{}},jump:{$imageFile:"skifree-objects.png",parts:{main:[109,55,32,8]},hitBehaviour:{}},signStart:{$imageFile:"skifree-objects.png",parts:{main:[260,103,42,27]},hitBehaviour:{}},snowboarder:{$imageFile:"sprite-characters.png",parts:{sEast:[73,229,20,29],sWest:[95,228,26,30]},hitBehaviour:{}},emptyChairLift:{$imageFile:"skifree-objects.png",parts:{main:[92,136,26,30]},zIndexesOccupied:[1]}};t.monster.hitBehaviour.tree=n,t.smallTree.hitBehaviour.monster=r,t.tallTree.hitBehaviour.monster=r,t.smallTree.hitBehaviour.skier=s,t.tallTree.hitBehaviour.skier=s,t.rock.hitBehaviour.skier=o,t.jump.hitBehaviour.skier=a,t.snowboarder.hitBehaviour.skier=f,e.spriteInfo=t})(this),typeof t!="undefined"&&(t.exports=this.spriteInfo)},{}],15:[function(e,t,n){(function(){function p(e,t,n){if(e.addEventListener){e.addEventListener(t,n,!1);return}e.attachEvent("on"+t,n)}function d(t){return t.type=="keypress"?String.fromCharCode(t.which):e[t.which]?e[t.which]:n[t.which]?n[t.which]:String.fromCharCode(t.which).toLowerCase()}function v(e,t){return e.sort().join(",")===t.sort().join(",")}function m(e){e=e||{};var t=!1,n;for(n in a){if(e[n]){t=!0;continue}a[n]=0}t||(c=!1)}function g(e,t,n,r,i){var s,u,f=[],l=n.type;if(!o[e])return[];l=="keyup"&&S(e)&&(t=[e]);for(s=0;s<o[e].length;++s){u=o[e][s];if(u.seq&&a[u.seq]!=u.level)continue;if(l!=u.action)continue;if(l=="keypress"&&!n.metaKey&&!n.ctrlKey||v(t,u.modifiers))r&&u.combo==i&&o[e].splice(s,1),f.push(u)}return f}function y(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function b(e,t){e(t)===!1&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function w(e,t){if(A.stopCallback(t,t.target||t.srcElement))return;var n=g(e,y(t),t),r,i={},s=!1;for(r=0;r<n.length;++r){if(n[r].seq){s=!0,i[n[r].seq]=1,b(n[r].callback,t);continue}!s&&!c&&b(n[r].callback,t)}t.type==c&&!S(e)&&m(i)}function E(e){e.which=typeof e.which=="number"?e.which:e.keyCode;var t=d(e);if(!t)return;if(e.type=="keyup"&&l==t){l=!1;return}w(t,e)}function S(e){return e=="shift"||e=="ctrl"||e=="alt"||e=="meta"}function x(){clearTimeout(f),f=setTimeout(m,1e3)}function T(){if(!s){s={};for(var t in e){if(t>95&&t<112)continue;e.hasOwnProperty(t)&&(s[e[t]]=t)}}return s}function N(e,t,n){return n||(n=T()[e]?"keydown":"keypress"),n=="keypress"&&t.length&&(n="keydown"),n}function C(e,t,n,r){a[e]=0,r||(r=N(t[0],[]));var i=function(t){c=r,++a[e],x()},s=function(e){b(n,e),r!=="keyup"&&(l=d(e)),setTimeout(m,10)},o;for(o=0;o<t.length;++o)k(t[o],o<t.length-1?i:s,r,e,o)}function k(e,t,n,s,u){e=e.replace(/\s+/g," ");var a=e.split(" "),f,l,c,h=[];if(a.length>1){C(e,a,t,n);return}c=e==="+"?["+"]:e.split("+");for(f=0;f<c.length;++f)l=c[f],i[l]&&(l=i[l]),n&&n!="keypress"&&r[l]&&(l=r[l],h.push("shift")),S(l)&&h.push(l);n=N(l,h,n),o[l]||(o[l]=[]),g(l,h,{type:n},!s,e),o[l][s?"unshift":"push"]({callback:t,modifiers:h,action:n,seq:s,level:u,combo:e})}function L(e,t,n){for(var r=0;r<e.length;++r)k(e[r],t,n)}var e={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},n={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},i={option:"alt",command:"meta","return":"enter",escape:"esc"},s,o={},u={},a={},f,l=!1,c=!1;for(var h=1;h<20;++h)e[111+h]="f"+h;for(h=0;h<=9;++h)e[h+96]=h;p(document,"keypress",E),p(document,"keydown",E),p(document,"keyup",E);var A={bind:function(e,t,n){return L(e instanceof Array?e:[e],t,n),u[e+":"+n]=t,this},unbind:function(e,t){return u[e+":"+t]&&(delete u[e+":"+t],this.bind(e,function(){},t)),this},trigger:function(e,t){return u[e+":"+t](),this},reset:function(){return o={},u={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:t.tagName=="INPUT"||t.tagName=="SELECT"||t.tagName=="TEXTAREA"||t.contentEditable&&t.contentEditable=="true"}};window.Mousetrap=A,typeof define=="function"&&define.amd&&define("mousetrap",function(){return A}),typeof t=="object"&&t.exports&&(t.exports=A)})()},{}],16:[function(e,t,n){(function(r){(function(){function a(e){var t=1,n=o.min(e);while(t!==0)t=o.reduce(e,function(e,t){return e+t%n},0),t!==0&&(n-=10);return n}function f(e){var t=u.exec(e);if(!t)throw new Error("I don't understand that particular interval");var n=+t[1],r=t[2]||"ms";if(r==="s")n*=1e3;else if(r==="m")n=n*1e3*60;else if(r==="h")n=n*1e3*60*60;else if(!!r&&r!=="ms")throw new Error("You can only specify intervals of ms, s, m, or h");if(n<10||n%10!==0)throw new Error("You can only specify 10s of milliseconds, trust me on this one");return{amount:n,type:r}}function l(){this.intervalId=undefined,this.intervalLength=undefined,this.intervalsToEmit={},this.currentTick=1,this.maxTicks=0,this.listeningForFocus=!1;var e=function(){var e=a(o.keys(this.intervalsToEmit)),t=!1;return this.intervalLength?e!==this.intervalLength&&(this.intervalLength=e,t=!0):this.intervalLength=e,this.maxTicks=o.max(o.map(o.keys(this.intervalsToEmit),function(e){return+e}))/this.intervalLength,t}.bind(this);this.on("newListener",function(t){if(t==="removeListener"||t==="newListener")return;var n=f(t),r=n.amount;this.intervalsToEmit[+r]=o.union(this.intervalsToEmit[+r]||[],[t]),e()&&this.isStarted()&&this.stop().start()}),this.on("removeListener",function(t){if(s.listenerCount(this,t)>0)return;var n=f(t),r=n.amount,i=this.intervalsToEmit[+r].removeOne(t);this.intervalsToEmit[+r].length===0&&delete this.intervalsToEmit[+r],console.log("Determining interval length after removal of",i),e(),e()&&this.isStarted()&&this.stop().start()})}var i=this,s=e("events").EventEmitter,o=e("underscore"),u=/([0-9\.]+)(ms|s|m|h)?/,i=r||window;typeof Function.prototype.inherits=="undefined"&&(Function.prototype.inherits=function(e){this.prototype=Object.create(e.prototype)}),typeof Array.prototype.removeOne=="undefined"&&(Array.prototype.removeOne=function(){var e,t=arguments,n=t.length,r;while(n&&this.length){e=t[--n];while((r=this.indexOf(e))!==-1)return this.splice(r,1)}}),l.inherits(s),l.prototype.tick=function(){var e=this.currentTick*this.intervalLength;return o.each(this.intervalsToEmit,function(t,n){e%n===0&&o.each(t,function(e){this.emit(e,e,n)}.bind(this))}.bind(this)),this.currentTick+=1,this.currentTick>this.maxTicks&&(this.currentTick=1),this},l.prototype.start=function(){if(!this.intervalLength)throw new Error("You haven't specified any interval callbacks. Use EventedLoop.on('500ms', function () { ... }) to do so, and then you can start");return this.intervalId?console.log("No need to start the loop again, it's already started."):(this.intervalId=setInterval(this.tick.bind(this),this.intervalLength),i&&!this.listeningForFocus&&i.addEventListener&&(i.addEventListener("focus",function(){this.start()}.bind(this)),i.addEventListener("blur",function(){this.stop()}.bind(this)),this.listeningForFocus=!0),this)},l.prototype.stop=function(){return clearInterval(this.intervalId),this.intervalId=undefined,this},l.prototype.isStarted=function(){return!!this.intervalId},l.prototype.every=l.prototype.on,typeof n!="undefined"&&(typeof t!="undefined"&&t.exports&&(n=t.exports=l),n.EventedLoop=l),typeof window!="undefined"&&(window.EventedLoop=l)}).call(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{events:19,underscore:17}],17:[function(e,t,n){(function(){var e=this,r=e._,i={},s=Array.prototype,o=Object.prototype,u=Function.prototype,a=s.push,f=s.slice,l=s.concat,c=o.toString,h=o.hasOwnProperty,p=s.forEach,d=s.map,v=s.reduce,m=s.reduceRight,g=s.filter,y=s.every,b=s.some,w=s.indexOf,E=s.lastIndexOf,S=Array.isArray,x=Object.keys,T=u.bind,N=function(e){if(e instanceof N)return e;if(!(this instanceof N))return new N(e);this._wrapped=e};typeof n!="undefined"?(typeof t!="undefined"&&t.exports&&(n=t.exports=N),n._=N):e._=N,N.VERSION="1.6.0";var C=N.each=N.forEach=function(e,t,n){if(e==null)return e;if(p&&e.forEach===p)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,s=e.length;r<s;r++)if(t.call(n,e[r],r,e)===i)return}else{var o=N.keys(e);for(var r=0,s=o.length;r<s;r++)if(t.call(n,e[o[r]],o[r],e)===i)return}return e};N.map=N.collect=function(e,t,n){var r=[];return e==null?r:d&&e.map===d?e.map(t,n):(C(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var k="Reduce of empty array with no initial value";N.reduce=N.foldl=N.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(v&&e.reduce===v)return r&&(t=N.bind(t,r)),i?e.reduce(t,n
):e.reduce(t);C(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(k);return n},N.reduceRight=N.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(m&&e.reduceRight===m)return r&&(t=N.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=N.keys(e);s=o.length}C(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(k);return n},N.find=N.detect=function(e,t,n){var r;return L(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},N.filter=N.select=function(e,t,n){var r=[];return e==null?r:g&&e.filter===g?e.filter(t,n):(C(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},N.reject=function(e,t,n){return N.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},N.every=N.all=function(e,t,n){t||(t=N.identity);var r=!0;return e==null?r:y&&e.every===y?e.every(t,n):(C(e,function(e,s,o){if(!(r=r&&t.call(n,e,s,o)))return i}),!!r)};var L=N.some=N.any=function(e,t,n){t||(t=N.identity);var r=!1;return e==null?r:b&&e.some===b?e.some(t,n):(C(e,function(e,s,o){if(r||(r=t.call(n,e,s,o)))return i}),!!r)};N.contains=N.include=function(e,t){return e==null?!1:w&&e.indexOf===w?e.indexOf(t)!=-1:L(e,function(e){return e===t})},N.invoke=function(e,t){var n=f.call(arguments,2),r=N.isFunction(t);return N.map(e,function(e){return(r?t:e[t]).apply(e,n)})},N.pluck=function(e,t){return N.map(e,N.property(t))},N.where=function(e,t){return N.filter(e,N.matches(t))},N.findWhere=function(e,t){return N.find(e,N.matches(t))},N.max=function(e,t,n){if(!t&&N.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-Infinity,i=-Infinity;return C(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;u>i&&(r=e,i=u)}),r},N.min=function(e,t,n){if(!t&&N.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=Infinity,i=Infinity;return C(e,function(e,s,o){var u=t?t.call(n,e,s,o):e;u<i&&(r=e,i=u)}),r},N.shuffle=function(e){var t,n=0,r=[];return C(e,function(e){t=N.random(n++),r[n-1]=r[t],r[t]=e}),r},N.sample=function(e,t,n){return t==null||n?(e.length!==+e.length&&(e=N.values(e)),e[N.random(e.length-1)]):N.shuffle(e).slice(0,Math.max(0,t))};var A=function(e){return e==null?N.identity:N.isFunction(e)?e:N.property(e)};N.sortBy=function(e,t,n){return t=A(t),N.pluck(N.map(e,function(e,r,i){return{value:e,index:r,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var O=function(e){return function(t,n,r){var i={};return n=A(n),C(t,function(s,o){var u=n.call(r,s,o,t);e(i,u,s)}),i}};N.groupBy=O(function(e,t,n){N.has(e,t)?e[t].push(n):e[t]=[n]}),N.indexBy=O(function(e,t,n){e[t]=n}),N.countBy=O(function(e,t){N.has(e,t)?e[t]++:e[t]=1}),N.sortedIndex=function(e,t,n,r){n=A(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},N.toArray=function(e){return e?N.isArray(e)?f.call(e):e.length===+e.length?N.map(e,N.identity):N.values(e):[]},N.size=function(e){return e==null?0:e.length===+e.length?e.length:N.keys(e).length},N.first=N.head=N.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:t<0?[]:f.call(e,0,t)},N.initial=function(e,t,n){return f.call(e,0,e.length-(t==null||n?1:t))},N.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:f.call(e,Math.max(e.length-t,0))},N.rest=N.tail=N.drop=function(e,t,n){return f.call(e,t==null||n?1:t)},N.compact=function(e){return N.filter(e,N.identity)};var M=function(e,t,n){return t&&N.every(e,N.isArray)?l.apply(n,e):(C(e,function(e){N.isArray(e)||N.isArguments(e)?t?a.apply(n,e):M(e,t,n):n.push(e)}),n)};N.flatten=function(e,t){return M(e,t,[])},N.without=function(e){return N.difference(e,f.call(arguments,1))},N.partition=function(e,t){var n=[],r=[];return C(e,function(e){(t(e)?n:r).push(e)}),[n,r]},N.uniq=N.unique=function(e,t,n,r){N.isFunction(t)&&(r=n,n=t,t=!1);var i=n?N.map(e,n,r):e,s=[],o=[];return C(i,function(n,r){if(t?!r||o[o.length-1]!==n:!N.contains(o,n))o.push(n),s.push(e[r])}),s},N.union=function(){return N.uniq(N.flatten(arguments,!0))},N.intersection=function(e){var t=f.call(arguments,1);return N.filter(N.uniq(e),function(e){return N.every(t,function(t){return N.contains(t,e)})})},N.difference=function(e){var t=l.apply(s,f.call(arguments,1));return N.filter(e,function(e){return!N.contains(t,e)})},N.zip=function(){var e=N.max(N.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=N.pluck(arguments,""+n);return t},N.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},N.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=N.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(w&&e.indexOf===w)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},N.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(E&&e.lastIndexOf===E)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},N.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var _=function(){};N.bind=function(e,t){var n,r;if(T&&e.bind===T)return T.apply(e,f.call(arguments,1));if(!N.isFunction(e))throw new TypeError;return n=f.call(arguments,2),r=function(){if(this instanceof r){_.prototype=e.prototype;var i=new _;_.prototype=null;var s=e.apply(i,n.concat(f.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(f.call(arguments)))}},N.partial=function(e){var t=f.call(arguments,1);return function(){var n=0,r=t.slice();for(var i=0,s=r.length;i<s;i++)r[i]===N&&(r[i]=arguments[n++]);while(n<arguments.length)r.push(arguments[n++]);return e.apply(this,r)}},N.bindAll=function(e){var t=f.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=N.bind(e[t],e)}),e},N.memoize=function(e,t){var n={};return t||(t=N.identity),function(){var r=t.apply(this,arguments);return N.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},N.delay=function(e,t){var n=f.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},N.defer=function(e){return N.delay.apply(N,[e,1].concat(f.call(arguments,1)))},N.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:N.now(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=N.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},N.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=N.now()-o;f<t?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),s=i=null))};return function(){s=this,i=arguments,o=N.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},N.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},N.wrap=function(e,t){return N.partial(t,e)},N.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},N.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},N.keys=function(e){if(!N.isObject(e))return[];if(x)return x(e);var t=[];for(var n in e)N.has(e,n)&&t.push(n);return t},N.values=function(e){var t=N.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},N.pairs=function(e){var t=N.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},N.invert=function(e){var t={},n=N.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},N.functions=N.methods=function(e){var t=[];for(var n in e)N.isFunction(e[n])&&t.push(n);return t.sort()},N.extend=function(e){return C(f.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},N.pick=function(e){var t={},n=l.apply(s,f.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},N.omit=function(e){var t={},n=l.apply(s,f.call(arguments,1));for(var r in e)N.contains(n,r)||(t[r]=e[r]);return t},N.defaults=function(e){return C(f.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},N.clone=function(e){return N.isObject(e)?N.isArray(e)?e.slice():N.extend({},e):e},N.tap=function(e,t){return t(e),e};var D=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof N&&(e=e._wrapped),t instanceof N&&(t=t._wrapped);var i=c.call(e);if(i!=c.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(N.isFunction(o)&&o instanceof o&&N.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var a=0,f=!0;if(i=="[object Array]"){a=e.length,f=a==t.length;if(f)while(a--)if(!(f=D(e[a],t[a],n,r)))break}else{for(var l in e)if(N.has(e,l)){a++;if(!(f=N.has(t,l)&&D(e[l],t[l],n,r)))break}if(f){for(l in t)if(N.has(t,l)&&!(a--))break;f=!a}}return n.pop(),r.pop(),f};N.isEqual=function(e,t){return D(e,t,[],[])},N.isEmpty=function(e){if(e==null)return!0;if(N.isArray(e)||N.isString(e))return e.length===0;for(var t in e)if(N.has(e,t))return!1;return!0},N.isElement=function(e){return!!e&&e.nodeType===1},N.isArray=S||function(e){return c.call(e)=="[object Array]"},N.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){N["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),N.isArguments(arguments)||(N.isArguments=function(e){return!!e&&!!N.has(e,"callee")}),typeof /./!="function"&&(N.isFunction=function(e){return typeof e=="function"}),N.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},N.isNaN=function(e){return N.isNumber(e)&&e!=+e},N.isBoolean=function(e){return e===!0||e===!1||c.call(e)=="[object Boolean]"},N.isNull=function(e){return e===null},N.isUndefined=function(e){return e===void 0},N.has=function(e,t){return h.call(e,t)},N.noConflict=function(){return e._=r,this},N.identity=function(e){return e},N.constant=function(e){return function(){return e}},N.property=function(e){return function(t){return t[e]}},N.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},N.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},N.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},N.now=Date.now||function(){return(new Date).getTime()};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};P.unescape=N.invert(P.escape);var H={escape:new RegExp("["+N.keys(P.escape).join("")+"]","g"),unescape:new RegExp("("+N.keys(P.unescape).join("|")+")","g")};N.each(["escape","unescape"],function(e){N[e]=function(t){return t==null?"":(""+t).replace(H[e],function(t){return P[e][t]})}}),N.result=function(e,t){if(e==null)return void 0;var n=e[t];return N.isFunction(n)?n.call(e):n},N.mixin=function(e){C(N.functions(e),function(t){var n=N[t]=e[t];N.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),q.call(this,n.apply(N,e))}})};var B=0;N.uniqueId=function(e){var t=++B+"";return e?e+t:t},N.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\t|\u2028|\u2029/g;N.template=function(e,t,n){var r;n=N.defaults({},n,N.templateSettings);var i=new RegExp([(n.escape||j).source,(n.interpolate||j).source,(n.evaluate||j).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(I,function(e){return"\\"+F[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,N);var a=function(e){return r.call(this,e,N)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},N.chain=function(e){return N(e).chain()};var q=function(e){return this._chain?N(e).chain():e};N.mixin(N),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];N.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],q.call(this,n)}}),C(["concat","join","slice"],function(e){var t=s[e];N.prototype[e]=function(){return q.call(this,t.apply(this._wrapped,arguments))}}),N.extend(N.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return N})}).call(this)},{}],18:[function(e,t,n){(function(e,n){"use strict";function i(){if(r.READY)return;r.event.determineEventTypes(),r.utils.each(r.gestures,function(e){r.detection.register(e)}),r.event.onTouch(r.DOCUMENT,r.EVENT_MOVE,r.detection.detect),r.event.onTouch(r.DOCUMENT,r.EVENT_END,r.detection.detect),r.READY=!0}var r=function(e,t){return new r.Instance(e,t||{})};r.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},r.HAS_POINTEREVENTS=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,r.HAS_TOUCHEVENTS="ontouchstart"in e,r.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,r.NO_MOUSEEVENTS=r.HAS_TOUCHEVENTS&&e.navigator.userAgent.match(r.MOBILE_REGEX),r.EVENT_TYPES={},r.DIRECTION_DOWN="down",r.DIRECTION_LEFT="left",r.DIRECTION_UP="up",r.DIRECTION_RIGHT="right",r.POINTER_MOUSE="mouse",r.POINTER_TOUCH="touch",r.POINTER_PEN="pen",r.UPDATE_VELOCITY_INTERVAL=20,r.EVENT_START="start",r.EVENT_MOVE="move",r.EVENT_END="end",r.DOCUMENT=e.document,r.plugins=r.plugins||{},r.gestures=r.gestures||{},r.READY=!1,r.utils={extend:function(t,r,i){for(var s in r){if(t[s]!==n&&i)continue;t[s]=r[s]}return t},each:function(e,t,r){var i,s;if("forEach"in e)e.forEach(t,r);else if(e.length!==n){for(i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===!1)return}else for(i in e)if(e.hasOwnProperty(i)&&t.call(r,e[i],i,e)===!1)return},hasParent:function(e,t){while(e){if(e==t)return!0;e=e.parentNode}return!1},getCenter:function(t){var n=[],i=[];return r.utils.each(t,function(e){n.push(typeof e.clientX!="undefined"?e.clientX:e.pageX),i.push(typeof e.clientY!="undefined"?e.clientY:e.pageY)}),{pageX:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2,pageY:(Math.min.apply(Math,i)+Math.max.apply(Math,i))/2}},getVelocity:function(t,n,r){return{x:Math.abs(n/t)||0,y:Math.abs(r/t)||0}},getAngle:function(t,n){var r=n.pageY-t.pageY,i=n.pageX-t.pageX;return Math.atan2(r,i)*180/Math.PI},getDirection:function(t,n){var i=Math.abs(t.pageX-n.pageX),s=Math.abs(t.pageY-n.pageY);return i>=s?t.pageX-n.pageX>0?r.DIRECTION_LEFT:r.DIRECTION_RIGHT:t.pageY-n.pageY>0?r.DIRECTION_UP:r.DIRECTION_DOWN},getDistance:function(t,n){var r=n.pageX-t.pageX,i=n.pageY-t.pageY;return Math.sqrt(r*r+i*i)},getScale:function(t,n){return t.length>=2&&n.length>=2?this.getDistance(n[0],n[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,n){return t.length>=2&&n.length>=2?this.getAngle(n[1],n[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==r.DIRECTION_UP||t==r.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,n){if(!n||!t||!t.style)return;r.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(e){r.utils.each(n,function(n,r){e&&(r=e+r.substring(0,1).toUpperCase()+r.substring(1)),r in t.style&&(t.style[r]=n)})}),n.userSelect=="none"&&(t.onselectstart=function(){return!1}),n.userDrag=="none"&&(t.ondragstart=function(){return!1})},startDefaultBrowserBehavior:function(t,n){if(!n||!t||!t.style)return;r.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(e){r.utils.each(n,function(n,r){e&&(r=e+r.substring(0,1).toUpperCase()+r.substring(1)),r in t.style&&(t.style[r]="")})}),n.userSelect=="none"&&(t.onselectstart=null),n.userDrag=="none"&&(t.ondragstart=null)}},r.Instance=function(e,t){var n=this;return i(),this.element=e,this.enabled=!0,this.options=r.utils.extend(r.utils.extend({},r.defaults),t||{}),this.options.stop_browser_behavior&&r.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),this._eventStartHandler=r.event.onTouch(e,r.EVENT_START,function(e){n.enabled&&r.detection.startDetect(n,e)}),this._eventHandler=[],this},r.Instance.prototype={on:function(t,n){var i=t.split(" ");return r.utils.each(i,function(e){this.element.addEventListener(e,n,!1),this._eventHandler.push({gesture:e,handler:n})},this),this},off:function(t,n){var i=t.split(" ");return r.utils.each(i,function(e){this.element.removeEventListener(e,n,!1);var t=-1;r.utils.each(this._eventHandler,function(r,i){t===-1&&r.gesture===e&&r.handler===n&&(t=i)},this),t>-1&&this._eventHandler.splice(t,1)},this),this},trigger:function(t,n){n||(n={});var i=r.DOCUMENT.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=n;var s=this.element;return r.utils.hasParent(n.target,s)&&(s=n.target),s.dispatchEvent(i),this},enable:function(t){return this.enabled=t,this},dispose:function(){return this.options.stop_browser_behavior&&r.utils.startDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),r.utils.each(this._eventHandler,function(e){this.element.removeEventListener(e.gesture,e.handler,!1)},this),this._eventHandler.length=0,r.event.unbindDom(this.element,r.EVENT_TYPES[r.EVENT_START],this._eventStartHandler),this}};var s=null,o=!1,u=!1;r.event={bindDom:function(e,t,n){var i=t.split(" ");r.utils.each(i,function(t){e.addEventListener(t,n,!1)})},unbindDom:function(e,t,n){var i=t.split(" ");r.utils.each(i,function(t){e.removeEventListener(t,n,!1)})},onTouch:function(t,n,i){var a=this,f=function(f){var l=f.type.toLowerCase();if(l.match(/mouse/)&&u)return;l.match(/touch/)||l.match(/pointerdown/)||l.match(/mouse/)&&f.which===1?o=!0:l.match(/mouse/)&&!f.which&&(o=!1),l.match(/touch|pointer/)&&(u=!0);var c=0;if(o){r.HAS_POINTEREVENTS&&n!=r.EVENT_END?c=r.PointerEvent.updatePointer(n,f):l.match(/touch/)?c=f.touches.length:u||(c=l.match(/up/)?0:1),c>0&&n==r.EVENT_END?n=r.EVENT_MOVE:c||(n=r.EVENT_END);if(c||s===null)s=f;i.call(r.detection,a.collectEventData(t,n,a.getTouchList(s,n),f)),r.HAS_POINTEREVENTS&&n==r.EVENT_END&&(c=r.PointerEvent.updatePointer(n,f))}c||(s=null,o=!1,u=!1,r.PointerEvent.reset())};return this.bindDom(t,r.EVENT_TYPES[n],f),f},determineEventTypes:function(){var t;r.HAS_POINTEREVENTS?t=r.PointerEvent.getEvents():r.NO_MOUSEEVENTS?t=["touchstart","touchmove","touchend touchcancel"]:t=["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],r.EVENT_TYPES[r.EVENT_START]=t[0],r.EVENT_TYPES[r.EVENT_MOVE]=t[1],r.EVENT_TYPES[r.EVENT_END]=t[2]},getTouchList:function(t){return r.HAS_POINTEREVENTS?r.PointerEvent.getTouchList():t.touches?t.touches:(t.identifier=1,[t])},collectEventData:function(t,n,i,s){var o=r.POINTER_TOUCH;if(s.type.match(/mouse/)||r.PointerEvent.matchType(r.POINTER_MOUSE,s))o=r.POINTER_MOUSE;return{center:r.utils.getCenter(i),timeStamp:(new Date).getTime(),target:s.target,touches:i,eventType:n,pointerType:o,srcEvent:s,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return r.detection.stopDetect()}}}},r.PointerEvent={pointers:{},getTouchList:function(){var e=this,t=[];return r.utils.each(e.pointers,function(e){t.push(e)}),t},updatePointer:function(e,t){return e==r.EVENT_END?delete this.pointers[t.pointerId]:(t.identifier=t.pointerId,this.pointers[t.pointerId]=t),Object.keys(this.pointers).length},matchType:function(e,t){if(!t.pointerType)return!1;var n=t.pointerType,i={};return i[r.POINTER_MOUSE]=n===t.MSPOINTER_TYPE_MOUSE||n===r.POINTER_MOUSE,i[r.POINTER_TOUCH]=n===t.MSPOINTER_TYPE_TOUCH||n===r.POINTER_TOUCH,i[r.POINTER_PEN]=n===t.MSPOINTER_TYPE_PEN||n===r.POINTER_PEN,i[e]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},r.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,n){if(this.current)return;this.stopped=!1,this.current={inst:t,startEvent:r.utils.extend({},n),lastEvent:!1,lastVEvent:!1,velocity:!1,name:""},this.detect(n)},detect:function(t){if(!this.current||this.stopped)return;t=this.extendEventData(t);var n=this.current.inst.options;return r.utils.each(this.gestures,function(e){if(!this.stopped&&n[e.name]!==!1&&e.handler.call(e,t,this.current.inst)===!1)return this.stopDetect(),!1},this),this.current&&(this.current.lastEvent=t),t.eventType==r.EVENT_END&&!t.touches.length-1&&this.stopDetect(),t},stopDetect:function(){this.previous=r.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var n=this.current.startEvent,i=this.current.lastVEvent;n&&(t.touches.length!=n.touches.length||t.touches===n.touches)&&(n.touches=[],r.utils.each(t.touches,function(e){n.touches.push(r.utils.extend({},e))}));var s=t.timeStamp-n.timeStamp,o=t.center.pageX-n.center.pageX,u=t.center.pageY-n.center.pageY,a,f,l=this.current.velocity;return i!==!1&&t.timeStamp-i.timeStamp>r.UPDATE_VELOCITY_INTERVAL?(l=r.utils.getVelocity(t.timeStamp-i.timeStamp,t.center.pageX-i.center.pageX,t.center.pageY-i.center.pageY),this.current.lastVEvent=t,l.x>0&&l.y>0&&(this.current.velocity=l)):this.current.velocity===!1&&(l=r.utils.getVelocity(s,o,u),this.current.velocity=l,this.current.lastVEvent=t),t.eventType==="end"?(a=this.current.lastEvent&&this.current.lastEvent.interimAngle,f=this.current.lastEvent&&this.current.lastEvent.interimDirection):(a=this.current.lastEvent&&r.utils.getAngle(this.current.lastEvent.center,t.center),f=this.current.lastEvent&&r.utils.getDirection(this.current.lastEvent.center,t.center)),r.utils.extend(t,{deltaTime:s,deltaX:o,deltaY:u,velocityX:l.x,velocityY:l.y,distance:r.utils.getDistance(n.center,t.center),angle:r.utils.getAngle(n.center,t.center),interimAngle:a,direction:r.utils.getDirection(n.center,t.center),interimDirection:f,scale:r.utils.getScale(n.touches,t.touches),rotation:r.utils.getRotation(n.touches,t.touches),startEvent:n}),t},register:function(t){var i=t.defaults||{};return i[t.name]===n&&(i[t.name]=!0),r.utils.extend(r.defaults,i,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(e,t){return e.index<t.index?-1:e.index>t.index?1:0}),this.gestures}},r.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(t,n){if(r.detection.current.name!=this.name&&this.triggered){n.trigger(this.name+"end",t),this.triggered=!1;return}if(n.options.drag_max_touches>0&&t.touches.length>n.options.drag_max_touches)return;switch(t.eventType){case r.EVENT_START:this.triggered=!1;break;case r.EVENT_MOVE:if(t.distance<n.options.drag_min_distance&&r.detection.current.name!=this.name)return;if(r.detection.current.name!=this.name){r.detection.current.name=this.name;if(n.options.correct_for_drag_min_distance&&t.distance>0){var i=Math.abs(n.options.drag_min_distance/t.distance);r.detection.current.startEvent.center.pageX+=t.deltaX*i,r.detection.current.startEvent.center.pageY+=t.deltaY*i,t=r.detection.extendEventData(t)}}if(r.detection.current.lastEvent.drag_locked_to_axis||n.options.drag_lock_to_axis&&n.options.drag_lock_min_distance<=t.distance)t.drag_locked_to_axis=!0;var s=r.detection.current.lastEvent.direction;t.drag_locked_to_axis&&s!==t.direction&&(r.utils.isVertical(s)?t.direction=t.deltaY<0?r.DIRECTION_UP:r.DIRECTION_DOWN:t.direction=t.deltaX<0?r.DIRECTION_LEFT:r.DIRECTION_RIGHT),this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),n.trigger(this.name+t.direction,t),(n.options.drag_block_vertical&&r.utils.isVertical(t.direction)||n.options.drag_block_horizontal&&!r.utils.isVertical(t.direction))&&t.preventDefault();break;case r.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},r.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,n){switch(t.eventType){case r.EVENT_START:clearTimeout(this.timer),r.detection.current.name=this.name,this.timer=setTimeout(function(){r.detection.current.name=="hold"&&n.trigger("hold",t)},n.options.hold_timeout);break;case r.EVENT_MOVE:t.distance>n.options.hold_threshold&&clearTimeout(this.timer);break;case r.EVENT_END:clearTimeout(this.timer)}}},r.gestures.Release={name:"release",index:Infinity,handler:function(t,n){t.eventType==r.EVENT_END&&n.trigger(this.name,t)}},r.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(t,n){if(t.eventType==r.EVENT_END){if(n.options.swipe_max_touches>0&&t.touches.length<n.options.swipe_min_touches&&t.touches.length>n.options.swipe_max_touches)return;if(t.velocityX>n.options.swipe_velocity||t.velocityY>n.options.swipe_velocity)n.trigger(this.name,t),n.trigger(this.name+t.direction,t)}}},r.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(t,n){if(t.eventType==r.EVENT_MOVE&&!r.detection.current.reachedTapMaxDistance)r.detection.current.reachedTapMaxDistance=t.distance>n.options.tap_max_distance;else if(t.eventType==r.EVENT_END&&t.srcEvent.type!="touchcancel"){var i=r.detection.previous,s=!1;if(r.detection.current.reachedTapMaxDistance||t.deltaTime>n.options.tap_max_touchtime)return;i&&i.name=="tap"&&t.timeStamp-i.lastEvent.timeStamp<n.options.doubletap_interval&&t.distance<n.options.doubletap_distance&&(n.trigger("doubletap",t),s=!0);if(!s||n.options.tap_always)r.detection.current.name="tap",n.trigger(r.detection.current.name,t)}}},r.gestures.Touch={name:"touch",index:-Infinity,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(t,n){if(n.options.prevent_mouseevents&&t.pointerType==r.POINTER_MOUSE){t.stopDetect();return}n.options.prevent_default&&t.preventDefault(),t.eventType==r.EVENT_START&&n.trigger(this.name,t)}},r.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,n){if(r.detection.current.name!=this.name&&this.triggered){n.trigger(this.name+"end",t),this.triggered=!1;return}if(t.touches.length<2)return;n.options.transform_always_block&&t.preventDefault();switch(t.eventType){case r.EVENT_START:this.triggered=!1;break;case r.EVENT_MOVE:var i=Math.abs(1-t.scale),s=Math.abs(t.rotation);if(i<n.options.transform_min_scale&&s<n.options.transform_min_rotation)return;r.detection.current.name=this.name,this.triggered||(n.trigger(this.name+"start",t),this.triggered=!0),n.trigger(this.name,t),s>n.options.transform_min_rotation&&n.trigger("rotate",t),i>n.options.transform_min_scale&&(n.trigger("pinch",t),n.trigger("pinch"+(t.scale<1?"in":"out"),t));break;case r.EVENT_END:this.triggered&&n.trigger(this.name+"end",t),this.triggered=!1}}},typeof define=="function"&&define.amd?define(function(){return r}):typeof t=="object"&&t.exports?t.exports=r:e.Hammer=r})(window)},{}],19:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||undefined}function i(e){return typeof e=="function"}function s(e){return typeof e=="number"}function o(e){return typeof e=="object"&&e!==null}function u(e){return e===void 0}t.exports=r,r.EventEmitter=r,r.prototype._events=undefined,r.prototype._maxListeners=undefined,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,a,f;this._events||(this._events={});if(e==="error")if(!this._events.error||o(this._events.error)&&!this._events.error.length)throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');n=this._events[e];if(u(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=arguments.length,s=new Array(r-1);for(a=1;a<r;a++)s[a-1]=arguments[a];n.apply(this,s)}else if(o(n)){r=arguments.length,s=new Array(r-1);for(a=1;a<r;a++)s[a-1]=arguments[a];f=n.slice(),r=f.length;for(a=0;a<r;a++)f[a].apply(this,s)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t;if(o(this._events[e])&&!this._events[e].warned){var n;u(this._maxListeners)?n=r.defaultMaxListeners:n=this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),typeof console.trace=="function"&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,s,u;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;n=this._events[e],s=n.length,r=-1;if(n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(u=s;u-->0;)if(n[u]===t||n[u].listener&&n[u].listener===t){r=u;break}if(r<0)return this;n.length===1?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}return this.removeAllListeners("removeListener"),this._events={},this}n=this._events[e];if(i(n))this.removeListener(e,n);else while(n.length)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return!this._events||!this._events[e]?t=[]:i(this._events[e])?t=[this._events[e]]:t=this._events[e].slice(),t},r.listenerCount=function(e,t){var n;return!e._events||!e._events[t]?n=0:i(e._events[t])?n=1:n=e._events[t].length,n}},{}]},{},[13]);